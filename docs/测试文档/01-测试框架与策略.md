# Global Scripts V3 æµ‹è¯•æ¡†æ¶ä¸ç­–ç•¥

## ğŸ“‹ æµ‹è¯•æ¦‚è¿°

æœ¬æ–‡æ¡£å®šä¹‰äº†Global Scripts V3é¡¹ç›®çš„å®Œæ•´æµ‹è¯•ç­–ç•¥ã€æ¡†æ¶è®¾è®¡å’Œè´¨é‡ä¿è¯ä½“ç³»ï¼Œç¡®ä¿ç³»ç»Ÿçš„å¯é æ€§ã€æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚

## ğŸ¯ æµ‹è¯•ç›®æ ‡ä¸åŸåˆ™

### æ ¸å¿ƒæµ‹è¯•ç›®æ ‡
- **åŠŸèƒ½æ­£ç¡®æ€§**ï¼šæ‰€æœ‰åŠŸèƒ½æŒ‰è§„æ ¼æ­£ç¡®å®ç°
- **æ€§èƒ½è¾¾æ ‡**ï¼šæ»¡è¶³<10mså¯åŠ¨æ—¶é—´ç­‰æ€§èƒ½æŒ‡æ ‡
- **è´¨é‡ä¿è¯**ï¼šä»£ç è¦†ç›–ç‡â‰¥90%ï¼Œé›¶shellcheckè­¦å‘Š
- **ç”¨æˆ·ä½“éªŒ**ï¼šé”™è¯¯å¤„ç†å‹å¥½ï¼Œä½¿ç”¨æµç¨‹é¡ºç•…

### æµ‹è¯•åŸåˆ™
- **æµ‹è¯•é©±åŠ¨**ï¼šå…³é”®åŠŸèƒ½å…ˆå†™æµ‹è¯•å†å®ç°
- **è‡ªåŠ¨åŒ–ä¼˜å…ˆ**ï¼š90%+æµ‹è¯•è‡ªåŠ¨åŒ–æ‰§è¡Œ
- **åˆ†å±‚æµ‹è¯•**ï¼šå•å…ƒæµ‹è¯•â†’é›†æˆæµ‹è¯•â†’ç³»ç»Ÿæµ‹è¯•
- **æŒç»­é›†æˆ**ï¼šæ¯æ¬¡ä»£ç å˜æ›´éƒ½è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶

## ğŸ—ï¸ æµ‹è¯•æ¶æ„è®¾è®¡

### æµ‹è¯•åˆ†å±‚ç­–ç•¥
```bash
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç«¯åˆ°ç«¯æµ‹è¯• (E2E)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ ç”¨æˆ·åœºæ™¯æµ‹è¯•â”‚ â”‚ æ€§èƒ½æµ‹è¯•    â”‚ â”‚ å…¼å®¹æ€§æµ‹è¯•  â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    é›†æˆæµ‹è¯• (Integration)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ æ’ä»¶é›†æˆ    â”‚ â”‚ ç³»ç»Ÿé›†æˆ    â”‚ â”‚ APIé›†æˆ     â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    å•å…ƒæµ‹è¯• (Unit)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ å‡½æ•°æµ‹è¯•    â”‚ â”‚ æ¨¡å—æµ‹è¯•    â”‚ â”‚ å·¥å…·æµ‹è¯•    â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æµ‹è¯•æ¡†æ¶ç»„ä»¶
```bash
# æµ‹è¯•æ¡†æ¶ç›®å½•ç»“æ„
tests/
â”œâ”€â”€ framework/                    # æµ‹è¯•æ¡†æ¶æ ¸å¿ƒ
â”‚   â”œâ”€â”€ test_framework.sh        # æ ¸å¿ƒæµ‹è¯•å¼•æ“
â”‚   â”œâ”€â”€ assertions.sh            # æ–­è¨€å‡½æ•°åº“
â”‚   â”œâ”€â”€ mocks.sh                 # Mockå·¥å…·
â”‚   â””â”€â”€ reporters.sh             # æµ‹è¯•æŠ¥å‘Šç”Ÿæˆ
â”œâ”€â”€ unit/                        # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ test_core/               # æ ¸å¿ƒç»„ä»¶æµ‹è¯•
â”‚   â”œâ”€â”€ test_plugins/            # æ’ä»¶æµ‹è¯•
â”‚   â””â”€â”€ test_tools/              # å·¥å…·æµ‹è¯•
â”œâ”€â”€ integration/                 # é›†æˆæµ‹è¯•
â”‚   â”œâ”€â”€ test_plugin_integration/ # æ’ä»¶é›†æˆæµ‹è¯•
â”‚   â”œâ”€â”€ test_system_integration/ # ç³»ç»Ÿé›†æˆæµ‹è¯•
â”‚   â””â”€â”€ test_api_integration/    # APIé›†æˆæµ‹è¯•
â”œâ”€â”€ e2e/                         # ç«¯åˆ°ç«¯æµ‹è¯•
â”‚   â”œâ”€â”€ test_user_scenarios/     # ç”¨æˆ·åœºæ™¯æµ‹è¯•
â”‚   â”œâ”€â”€ test_performance/        # æ€§èƒ½æµ‹è¯•
â”‚   â””â”€â”€ test_compatibility/      # å…¼å®¹æ€§æµ‹è¯•
â”œâ”€â”€ fixtures/                    # æµ‹è¯•æ•°æ®å’Œé…ç½®
â”‚   â”œâ”€â”€ sample_plugins/          # ç¤ºä¾‹æ’ä»¶
â”‚   â”œâ”€â”€ test_configs/            # æµ‹è¯•é…ç½®
â”‚   â””â”€â”€ mock_data/               # æ¨¡æ‹Ÿæ•°æ®
â””â”€â”€ reports/                     # æµ‹è¯•æŠ¥å‘Šè¾“å‡º
    â”œâ”€â”€ coverage/                # è¦†ç›–ç‡æŠ¥å‘Š
    â”œâ”€â”€ performance/             # æ€§èƒ½æŠ¥å‘Š
    â””â”€â”€ integration/             # é›†æˆæµ‹è¯•æŠ¥å‘Š
```

## ğŸ§ª æµ‹è¯•æ¡†æ¶å®ç°

### æ ¸å¿ƒæµ‹è¯•å¼•æ“
```bash
#!/bin/bash
# Global Scripts V3 - æµ‹è¯•æ¡†æ¶æ ¸å¿ƒå¼•æ“
# æ–‡ä»¶: tests/framework/test_framework.sh

# æµ‹è¯•æ¡†æ¶ç‰ˆæœ¬
TEST_FRAMEWORK_VERSION="3.0.0"

# æµ‹è¯•çŠ¶æ€å¸¸é‡
TEST_PASS=0
TEST_FAIL=1
TEST_SKIP=2

# å…¨å±€æµ‹è¯•ç»Ÿè®¡
declare -gi _TEST_TOTAL=0
declare -gi _TEST_PASSED=0
declare -gi _TEST_FAILED=0
declare -gi _TEST_SKIPPED=0

# å½“å‰æµ‹è¯•ä¸Šä¸‹æ–‡
declare -g _CURRENT_TEST_SUITE=""
declare -g _CURRENT_TEST_CASE=""
declare -g _TEST_TEMP_DIR=""

# æµ‹è¯•å¥—ä»¶è¿è¡Œå™¨
run_test_suite() {
    local suite_name="$1"
    local setup_func="${2:-}"
    local teardown_func="${3:-}"
    
    _CURRENT_TEST_SUITE="$suite_name"
    echo "ğŸ§ª å¼€å§‹æµ‹è¯•å¥—ä»¶: $suite_name"
    
    # åˆ›å»ºä¸´æ—¶æµ‹è¯•ç›®å½•
    _TEST_TEMP_DIR=$(mktemp -d "/tmp/gs-test-${suite_name}-XXXXXX")
    
    # æ‰§è¡Œè®¾ç½®å‡½æ•°
    if [[ -n "$setup_func" ]] && declare -F "$setup_func" >/dev/null; then
        "$setup_func" || {
            echo "âŒ æµ‹è¯•å¥—ä»¶è®¾ç½®å¤±è´¥: $setup_func"
            return 1
        }
    fi
    
    # æŸ¥æ‰¾å¹¶æ‰§è¡Œæ‰€æœ‰æµ‹è¯•å‡½æ•°
    local test_functions
    test_functions=$(declare -F | grep "^test_${suite_name}_" | awk '{print $3}')
    
    for test_func in $test_functions; do
        run_test_case "$test_func"
    done
    
    # æ‰§è¡Œæ¸…ç†å‡½æ•°
    if [[ -n "$teardown_func" ]] && declare -F "$teardown_func" >/dev/null; then
        "$teardown_func"
    fi
    
    # æ¸…ç†ä¸´æ—¶ç›®å½•
    rm -rf "$_TEST_TEMP_DIR"
    
    # è¾“å‡ºå¥—ä»¶ç»“æœ
    echo "ğŸ“Š æµ‹è¯•å¥—ä»¶ '$suite_name' å®Œæˆ"
    echo "   æ€»è®¡: $_TEST_TOTAL, é€šè¿‡: $_TEST_PASSED, å¤±è´¥: $_TEST_FAILED, è·³è¿‡: $_TEST_SKIPPED"
}

# å•ä¸ªæµ‹è¯•ç”¨ä¾‹è¿è¡Œå™¨
run_test_case() {
    local test_func="$1"
    _CURRENT_TEST_CASE="$test_func"
    
    echo -n "  ğŸ”¬ $test_func ... "
    
    # æ‰§è¡Œæµ‹è¯•å‡½æ•°
    local start_time=$(date +%s%N)
    if "$test_func"; then
        local end_time=$(date +%s%N)
        local duration=$(( (end_time - start_time) / 1000000 ))
        echo "âœ… PASS (${duration}ms)"
        ((_TEST_PASSED++))
    else
        echo "âŒ FAIL"
        ((_TEST_FAILED++))
    fi
    
    ((_TEST_TOTAL++))
}

# æ–­è¨€å‡½æ•°
assert_equals() {
    local expected="$1"
    local actual="$2"
    local message="${3:-æ–­è¨€å¤±è´¥}"
    
    if [[ "$expected" != "$actual" ]]; then
        echo "    âŒ $message"
        echo "       æœŸæœ›å€¼: '$expected'"
        echo "       å®é™…å€¼: '$actual'"
        return 1
    fi
    return 0
}

assert_contains() {
    local haystack="$1"
    local needle="$2"
    local message="${3:-å­—ç¬¦ä¸²åŒ…å«æ–­è¨€å¤±è´¥}"
    
    if [[ "$haystack" != *"$needle"* ]]; then
        echo "    âŒ $message"
        echo "       å­—ç¬¦ä¸²: '$haystack'"
        echo "       ä¸åŒ…å«: '$needle'"
        return 1
    fi
    return 0
}

assert_file_exists() {
    local file_path="$1"
    local message="${2:-æ–‡ä»¶å­˜åœ¨æ–­è¨€å¤±è´¥}"
    
    if [[ ! -f "$file_path" ]]; then
        echo "    âŒ $message"
        echo "       æ–‡ä»¶ä¸å­˜åœ¨: '$file_path'"
        return 1
    fi
    return 0
}

assert_command_success() {
    local command="$1"
    local message="${2:-å‘½ä»¤æ‰§è¡Œæ–­è¨€å¤±è´¥}"
    
    if ! eval "$command" >/dev/null 2>&1; then
        echo "    âŒ $message"
        echo "       å‘½ä»¤å¤±è´¥: '$command'"
        return 1
    fi
    return 0
}

assert_command_output() {
    local command="$1"
    local expected_output="$2"
    local message="${3:-å‘½ä»¤è¾“å‡ºæ–­è¨€å¤±è´¥}"
    
    local actual_output
    actual_output=$(eval "$command" 2>&1)
    
    if [[ "$actual_output" != "$expected_output" ]]; then
        echo "    âŒ $message"
        echo "       å‘½ä»¤: '$command'"
        echo "       æœŸæœ›è¾“å‡º: '$expected_output'"
        echo "       å®é™…è¾“å‡º: '$actual_output'"
        return 1
    fi
    return 0
}

# Mockå·¥å…·
create_mock_function() {
    local func_name="$1"
    local mock_behavior="$2"
    
    eval "$func_name() { $mock_behavior; }"
}

# æµ‹è¯•è·³è¿‡
skip_test() {
    local reason="$1"
    echo "â­ï¸  è·³è¿‡: $reason"
    ((_TEST_SKIPPED++))
    ((_TEST_TOTAL++))
    return $TEST_SKIP
}

# æµ‹è¯•æŠ¥å‘Šç”Ÿæˆ
generate_test_report() {
    local report_file="${1:-tests/reports/test_report.txt}"
    
    {
        echo "Global Scripts V3 æµ‹è¯•æŠ¥å‘Š"
        echo "=========================="
        echo "ç”Ÿæˆæ—¶é—´: $(date)"
        echo "æµ‹è¯•æ¡†æ¶ç‰ˆæœ¬: $TEST_FRAMEWORK_VERSION"
        echo ""
        echo "æµ‹è¯•ç»Ÿè®¡:"
        echo "  æ€»è®¡: $_TEST_TOTAL"
        echo "  é€šè¿‡: $_TEST_PASSED"
        echo "  å¤±è´¥: $_TEST_FAILED"
        echo "  è·³è¿‡: $_TEST_SKIPPED"
        echo ""
        
        if (( _TEST_FAILED > 0 )); then
            echo "âŒ æµ‹è¯•ç»“æœ: FAIL"
            echo "æˆåŠŸç‡: $(( _TEST_PASSED * 100 / _TEST_TOTAL ))%"
        else
            echo "âœ… æµ‹è¯•ç»“æœ: PASS"
            echo "æˆåŠŸç‡: 100%"
        fi
    } > "$report_file"
    
    echo "ğŸ“„ æµ‹è¯•æŠ¥å‘Šå·²ç”Ÿæˆ: $report_file"
}
```

## ğŸ“Š æµ‹è¯•ç±»å‹è¯¦ç»†è§„èŒƒ

### 1. å•å…ƒæµ‹è¯•è§„èŒƒ

#### æ ¸å¿ƒç»„ä»¶æµ‹è¯•
```bash
#!/bin/bash
# ç¤ºä¾‹: tests/unit/test_core/test_logger.sh

source "${GS_ROOT}/tests/framework/test_framework.sh"
source "${GS_ROOT}/core/logger.sh"

# æµ‹è¯•ç¯å¢ƒè®¾ç½®
setup_logger_test() {
    export GS_LOG_LEVEL=DEBUG
    export GS_LOG_FILE="$_TEST_TEMP_DIR/test.log"
    mkdir -p "$(dirname "$GS_LOG_FILE")"
}

# æµ‹è¯•ç¯å¢ƒæ¸…ç†
teardown_logger_test() {
    unset GS_LOG_LEVEL GS_LOG_FILE
}

# æµ‹è¯•ç”¨ä¾‹ï¼šæ—¥å¿—åŸºæœ¬åŠŸèƒ½
test_logger_basic_logging() {
    local test_message="æµ‹è¯•æ—¥å¿—æ¶ˆæ¯"
    
    # æ‰§è¡Œæ—¥å¿—è®°å½•
    _gs_logger_info "$test_message"
    
    # éªŒè¯æ—¥å¿—æ–‡ä»¶å­˜åœ¨
    assert_file_exists "$GS_LOG_FILE" "æ—¥å¿—æ–‡ä»¶åº”è¯¥è¢«åˆ›å»º"
    
    # éªŒè¯æ—¥å¿—å†…å®¹
    local log_content
    log_content=$(cat "$GS_LOG_FILE")
    assert_contains "$log_content" "$test_message" "æ—¥å¿—åº”è¯¥åŒ…å«æµ‹è¯•æ¶ˆæ¯"
    assert_contains "$log_content" "INFO" "æ—¥å¿—åº”è¯¥åŒ…å«çº§åˆ«æ ‡è¯†"
}

# æµ‹è¯•ç”¨ä¾‹ï¼šæ—¥å¿—çº§åˆ«è¿‡æ»¤
test_logger_level_filtering() {
    # è®¾ç½®é«˜çº§åˆ«è¿‡æ»¤
    export GS_LOG_LEVEL=ERROR
    
    # è®°å½•ä¸åŒçº§åˆ«æ—¥å¿—
    _gs_logger_debug "debugæ¶ˆæ¯"
    _gs_logger_info "infoæ¶ˆæ¯"
    _gs_logger_error "erroræ¶ˆæ¯"
    
    # éªŒè¯åªæœ‰ERRORçº§åˆ«è¢«è®°å½•
    local log_content
    log_content=$(cat "$GS_LOG_FILE")
    
    assert_contains "$log_content" "erroræ¶ˆæ¯" "ERRORæ¶ˆæ¯åº”è¯¥è¢«è®°å½•"
    ! assert_contains "$log_content" "debugæ¶ˆæ¯" "DEBUGæ¶ˆæ¯ä¸åº”è¯¥è¢«è®°å½•"
    ! assert_contains "$log_content" "infoæ¶ˆæ¯" "INFOæ¶ˆæ¯ä¸åº”è¯¥è¢«è®°å½•"
}

# è¿è¡Œæµ‹è¯•å¥—ä»¶
run_test_suite "logger" setup_logger_test teardown_logger_test
```

#### æ’ä»¶æµ‹è¯•æ¨¡æ¿
```bash
#!/bin/bash
# æ’ä»¶æµ‹è¯•æ¨¡æ¿: tests/unit/test_plugins/test_android.sh

source "${GS_ROOT}/tests/framework/test_framework.sh"
source "${GS_ROOT}/plugins/android/android.sh"

setup_android_test() {
    # åˆ›å»ºMock ADBå‘½ä»¤
    create_mock_function "adb" "echo 'mock adb output'"
    
    # è®¾ç½®æµ‹è¯•ç¯å¢ƒå˜é‡
    export ANDROID_SDK_ROOT="$_TEST_TEMP_DIR/sdk"
    mkdir -p "$ANDROID_SDK_ROOT"
}

teardown_android_test() {
    unset ANDROID_SDK_ROOT
    unset -f adb  # ç§»é™¤mockå‡½æ•°
}

test_android_device_list() {
    local expected_output="mock adb output"
    
    # æµ‹è¯•è®¾å¤‡åˆ—è¡¨åŠŸèƒ½
    local actual_output
    actual_output=$(gs_android_device_list)
    
    assert_equals "$expected_output" "$actual_output" "è®¾å¤‡åˆ—è¡¨è¾“å‡ºåº”è¯¥åŒ¹é…"
}

test_android_adb_shell() {
    local test_command="ls /system"
    
    # æµ‹è¯•ADB shellåŠŸèƒ½
    assert_command_success "gs_android_adb_shell '$test_command'" "ADB shellå‘½ä»¤åº”è¯¥æ‰§è¡ŒæˆåŠŸ"
}

run_test_suite "android" setup_android_test teardown_android_test
```

### 2. é›†æˆæµ‹è¯•è§„èŒƒ

#### æ’ä»¶é›†æˆæµ‹è¯•
```bash
#!/bin/bash
# tests/integration/test_plugin_integration/test_plugin_loading.sh

source "${GS_ROOT}/tests/framework/test_framework.sh"
source "${GS_ROOT}/core/plugin_detector.sh"

setup_plugin_integration_test() {
    # åˆ›å»ºæµ‹è¯•æ’ä»¶
    mkdir -p "$_TEST_TEMP_DIR/plugins/testplugin"
    
    # åˆ›å»º.metaæ–‡ä»¶
    cat > "$_TEST_TEMP_DIR/plugins/testplugin/testplugin.meta" << 'EOF'
PLUGIN_TYPE=main
NAME=testplugin
VERSION=1.0.0
DESCRIPTION=æµ‹è¯•æ’ä»¶
EOF
    
    # åˆ›å»ºæ’ä»¶å®ç°
    cat > "$_TEST_TEMP_DIR/plugins/testplugin/testplugin.sh" << 'EOF'
gs_testplugin_hello() {
    echo "Hello from test plugin"
}

gs_testplugin_version() {
    echo "Test Plugin 1.0.0"
}
EOF
}

test_plugin_discovery() {
    # æµ‹è¯•æ’ä»¶å‘ç°åŠŸèƒ½
    local discovered_plugins
    discovered_plugins=$(_gs_discover_plugins "$_TEST_TEMP_DIR/plugins")
    
    assert_contains "$discovered_plugins" "testplugin" "åº”è¯¥å‘ç°æµ‹è¯•æ’ä»¶"
}

test_plugin_function_registration() {
    # åŠ è½½æ’ä»¶
    source "$_TEST_TEMP_DIR/plugins/testplugin/testplugin.sh"
    
    # æµ‹è¯•å‡½æ•°æ³¨å†Œ
    _gs_register_plugin_functions "testplugin"
    
    # éªŒè¯å‘½ä»¤åˆ«ååˆ›å»º
    assert_command_success "declare -F gs-testplugin-hello" "åº”è¯¥åˆ›å»ºgs-testplugin-helloåˆ«å"
    assert_command_success "declare -F gs-testplugin-version" "åº”è¯¥åˆ›å»ºgs-testplugin-versionåˆ«å"
}

test_plugin_command_execution() {
    # æµ‹è¯•æ’ä»¶å‘½ä»¤æ‰§è¡Œ
    local expected_output="Hello from test plugin"
    local actual_output
    
    actual_output=$(gs-testplugin-hello)
    assert_equals "$expected_output" "$actual_output" "æ’ä»¶å‘½ä»¤åº”è¯¥æ­£ç¡®æ‰§è¡Œ"
}

run_test_suite "plugin_integration" setup_plugin_integration_test
```

### 3. æ€§èƒ½æµ‹è¯•è§„èŒƒ

#### å¯åŠ¨æ€§èƒ½æµ‹è¯•
```bash
#!/bin/bash
# tests/e2e/test_performance/test_startup_performance.sh

source "${GS_ROOT}/tests/framework/test_framework.sh"

setup_performance_test() {
    # æ¸…ç†ç¼“å­˜ç¡®ä¿å†·å¯åŠ¨
    rm -rf "${GS_CACHE_DIR:-/tmp/gs-cache}"
}

test_cold_startup_time() {
    local max_startup_time=100  # 100msä¸Šé™
    local iterations=10
    local total_time=0
    
    for ((i=1; i<=iterations; i++)); do
        # æµ‹é‡å¯åŠ¨æ—¶é—´
        local start_time=$(date +%s%N)
        
        # æ¨¡æ‹Ÿç³»ç»Ÿå¯åŠ¨ï¼ˆsource gs_env.shï¼‰
        (
            source "$GS_ROOT/gs_env.sh" >/dev/null 2>&1
            gs-help >/dev/null 2>&1
        )
        
        local end_time=$(date +%s%N)
        local duration=$(( (end_time - start_time) / 1000000 ))
        total_time=$((total_time + duration))
        
        echo "    å¯åŠ¨ $i: ${duration}ms"
    done
    
    local avg_time=$((total_time / iterations))
    echo "    å¹³å‡å¯åŠ¨æ—¶é—´: ${avg_time}ms"
    
    if (( avg_time > max_startup_time )); then
        echo "    âŒ å¯åŠ¨æ—¶é—´è¶…è¿‡é™åˆ¶: ${avg_time}ms > ${max_startup_time}ms"
        return 1
    fi
    
    echo "    âœ… å¯åŠ¨æ—¶é—´ç¬¦åˆè¦æ±‚: ${avg_time}ms â‰¤ ${max_startup_time}ms"
    return 0
}

test_warm_startup_time() {
    local max_warm_time=50  # 50msä¸Šé™ï¼ˆæœ‰ç¼“å­˜ï¼‰
    
    # é¢„çƒ­ç¼“å­˜
    source "$GS_ROOT/gs_env.sh" >/dev/null 2>&1
    
    # æµ‹é‡çƒ­å¯åŠ¨æ—¶é—´
    local start_time=$(date +%s%N)
    source "$GS_ROOT/gs_env.sh" >/dev/null 2>&1
    local end_time=$(date +%s%N)
    
    local duration=$(( (end_time - start_time) / 1000000 ))
    echo "    çƒ­å¯åŠ¨æ—¶é—´: ${duration}ms"
    
    if (( duration > max_warm_time )); then
        echo "    âŒ çƒ­å¯åŠ¨æ—¶é—´è¶…è¿‡é™åˆ¶: ${duration}ms > ${max_warm_time}ms"
        return 1
    fi
    
    echo "    âœ… çƒ­å¯åŠ¨æ—¶é—´ç¬¦åˆè¦æ±‚: ${duration}ms â‰¤ ${max_warm_time}ms"
    return 0
}

test_memory_usage() {
    local max_memory=10240  # 10MBä¸Šé™ (KB)
    
    # å¯åŠ¨ç³»ç»Ÿå¹¶æµ‹é‡å†…å­˜ä½¿ç”¨
    (
        source "$GS_ROOT/gs_env.sh" >/dev/null 2>&1
        
        # è·å–å½“å‰è¿›ç¨‹å†…å­˜ä½¿ç”¨
        local memory_kb
        memory_kb=$(ps -o rss= -p $$)
        
        echo "    å†…å­˜ä½¿ç”¨: ${memory_kb}KB ($(( memory_kb / 1024 ))MB)"
        
        if (( memory_kb > max_memory )); then
            echo "    âŒ å†…å­˜ä½¿ç”¨è¶…è¿‡é™åˆ¶: ${memory_kb}KB > ${max_memory}KB"
            exit 1
        fi
        
        echo "    âœ… å†…å­˜ä½¿ç”¨ç¬¦åˆè¦æ±‚: ${memory_kb}KB â‰¤ ${max_memory}KB"
    )
}

run_test_suite "startup_performance" setup_performance_test
```

## ğŸ¯ æµ‹è¯•è¦†ç›–ç‡è¦æ±‚

### è¦†ç›–ç‡ç›®æ ‡
```bash
# æµ‹è¯•è¦†ç›–ç‡è¦æ±‚
æ ¸å¿ƒç»„ä»¶:     100%è¦†ç›– (core/*)
ç³»ç»Ÿå‘½ä»¤:     100%è¦†ç›– (system/*)
æ’ä»¶æ¡†æ¶:     95%è¦†ç›–  (plugins/*)
å·¥å…·é“¾:       90%è¦†ç›–  (tools/*)
å·¥å…·å‡½æ•°:     85%è¦†ç›–  (lib/*)

# æ•´ä½“ç›®æ ‡
æ€»ä½“è¦†ç›–ç‡:   â‰¥90%
å…³é”®è·¯å¾„:     100%è¦†ç›–
é”™è¯¯å¤„ç†:     100%è¦†ç›–
```

### è¦†ç›–ç‡æµ‹è¯•å·¥å…·
```bash
#!/bin/bash
# tools/coverage/generate_coverage.sh

# ç”Ÿæˆä»£ç è¦†ç›–ç‡æŠ¥å‘Š
generate_coverage_report() {
    local output_dir="${1:-tests/reports/coverage}"
    mkdir -p "$output_dir"
    
    echo "ğŸ” ç”Ÿæˆä»£ç è¦†ç›–ç‡æŠ¥å‘Š..."
    
    # ä½¿ç”¨kcovæˆ–è‡ªå®šä¹‰è¦†ç›–ç‡å·¥å…·
    # è¿™é‡Œæ˜¯ç®€åŒ–ç‰ˆå®ç°
    find "$GS_ROOT" -name "*.sh" -not -path "*/tests/*" | while read -r file; do
        local coverage_file="$output_dir/$(basename "$file").coverage"
        
        # åˆ†æå‡½æ•°è¦†ç›–æƒ…å†µï¼ˆç®€åŒ–ç‰ˆï¼‰
        local total_functions
        total_functions=$(grep -c "^[a-zA-Z_][a-zA-Z0-9_]*\s*()" "$file" || echo 0)
        
        local tested_functions=0
        if [[ -f "${file%%.sh}_test.sh" ]]; then
            tested_functions=$(grep -c "test_.*$(basename "${file%%.sh}")" "${file%%.sh}_test.sh" || echo 0)
        fi
        
        local coverage_percent=0
        if (( total_functions > 0 )); then
            coverage_percent=$(( tested_functions * 100 / total_functions ))
        fi
        
        echo "File: $file" > "$coverage_file"
        echo "Total Functions: $total_functions" >> "$coverage_file"
        echo "Tested Functions: $tested_functions" >> "$coverage_file"
        echo "Coverage: ${coverage_percent}%" >> "$coverage_file"
    done
    
    echo "ğŸ“Š è¦†ç›–ç‡æŠ¥å‘Šå·²ç”Ÿæˆ: $output_dir"
}
```

## ğŸš€ è‡ªåŠ¨åŒ–æµ‹è¯•æµç¨‹

### CI/CDé›†æˆ
```bash
#!/bin/bash
# .github/workflows/test.yml çš„Shellè„šæœ¬éƒ¨åˆ†

# å®Œæ•´æµ‹è¯•æµç¨‹
run_complete_test_suite() {
    echo "ğŸš€ å¼€å§‹å®Œæ•´æµ‹è¯•æµç¨‹..."
    
    # 1. ä»£ç è´¨é‡æ£€æŸ¥
    echo "1ï¸âƒ£ ä»£ç è´¨é‡æ£€æŸ¥"
    if ! tools/lint/run_shellcheck.sh; then
        echo "âŒ Shellcheckæ£€æŸ¥å¤±è´¥"
        return 1
    fi
    
    # 2. å•å…ƒæµ‹è¯•
    echo "2ï¸âƒ£ å•å…ƒæµ‹è¯•"
    if ! tests/run_unit_tests.sh; then
        echo "âŒ å•å…ƒæµ‹è¯•å¤±è´¥"
        return 1
    fi
    
    # 3. é›†æˆæµ‹è¯•
    echo "3ï¸âƒ£ é›†æˆæµ‹è¯•"
    if ! tests/run_integration_tests.sh; then
        echo "âŒ é›†æˆæµ‹è¯•å¤±è´¥"
        return 1
    fi
    
    # 4. æ€§èƒ½æµ‹è¯•
    echo "4ï¸âƒ£ æ€§èƒ½æµ‹è¯•"
    if ! tests/run_performance_tests.sh; then
        echo "âŒ æ€§èƒ½æµ‹è¯•å¤±è´¥"
        return 1
    fi
    
    # 5. å…¼å®¹æ€§æµ‹è¯•
    echo "5ï¸âƒ£ å…¼å®¹æ€§æµ‹è¯•"
    if ! tests/run_compatibility_tests.sh; then
        echo "âŒ å…¼å®¹æ€§æµ‹è¯•å¤±è´¥"
        return 1
    fi
    
    # 6. ç”ŸæˆæŠ¥å‘Š
    echo "6ï¸âƒ£ ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š"
    generate_test_report
    tools/coverage/generate_coverage.sh
    
    echo "âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼"
    return 0
}

# æµ‹è¯•è¿è¡Œå™¨è„šæœ¬
main() {
    case "${1:-all}" in
        "unit")
            tests/run_unit_tests.sh
            ;;
        "integration")
            tests/run_integration_tests.sh
            ;;
        "performance")
            tests/run_performance_tests.sh
            ;;
        "compatibility")
            tests/run_compatibility_tests.sh
            ;;
        "all"|*)
            run_complete_test_suite
            ;;
    esac
}

main "$@"
```

## ğŸ“‹ æµ‹è¯•æ£€æŸ¥æ¸…å•

### å‘å¸ƒå‰æµ‹è¯•æ¸…å•
- [ ] **å•å…ƒæµ‹è¯•**: æ‰€æœ‰æ ¸å¿ƒç»„ä»¶æµ‹è¯•é€šè¿‡
- [ ] **é›†æˆæµ‹è¯•**: æ’ä»¶å’Œç³»ç»Ÿé›†æˆæµ‹è¯•é€šè¿‡
- [ ] **æ€§èƒ½æµ‹è¯•**: å¯åŠ¨æ—¶é—´å’Œå†…å­˜ä½¿ç”¨è¾¾æ ‡
- [ ] **å…¼å®¹æ€§æµ‹è¯•**: å¤šå¹³å°å’Œå¤šShellç¯å¢ƒæµ‹è¯•é€šè¿‡
- [ ] **å›å½’æµ‹è¯•**: æ‰€æœ‰å·²ä¿®å¤bugä¸å†å¤ç°
- [ ] **ç”¨æˆ·ä½“éªŒæµ‹è¯•**: å…¸å‹ç”¨æˆ·åœºæ™¯æµ‹è¯•é€šè¿‡
- [ ] **æ–‡æ¡£æµ‹è¯•**: æ‰€æœ‰ç¤ºä¾‹ä»£ç å¯ä»¥æ‰§è¡Œ
- [ ] **å®‰å…¨æµ‹è¯•**: æ— å®‰å…¨æ¼æ´å’Œé£é™©

### æµ‹è¯•è´¨é‡æ ‡å‡†
- **è¦†ç›–ç‡**: â‰¥90%ä»£ç è¦†ç›–ç‡
- **æ–­è¨€è´¨é‡**: æ¯ä¸ªæµ‹è¯•éƒ½æœ‰æ˜ç¡®çš„æ–­è¨€
- **æµ‹è¯•ç‹¬ç«‹æ€§**: æµ‹è¯•ä¹‹é—´æ— ä¾èµ–å…³ç³»
- **æ‰§è¡Œæ•ˆç‡**: å®Œæ•´æµ‹è¯•å¥—ä»¶<5åˆ†é’Ÿ
- **æŠ¥å‘Šæ¸…æ™°**: æµ‹è¯•å¤±è´¥åŸå› æ˜ç¡®
- **ç»´æŠ¤æ€§**: æµ‹è¯•ä»£ç æ˜“äºç†è§£å’Œç»´æŠ¤

è¿™ä¸ªæµ‹è¯•æ¡†æ¶ç¡®ä¿äº†Global Scripts V3çš„é«˜è´¨é‡äº¤ä»˜ï¼Œé€šè¿‡å…¨é¢çš„æµ‹è¯•ç­–ç•¥å’Œè‡ªåŠ¨åŒ–æµç¨‹ä¿è¯ç³»ç»Ÿçš„å¯é æ€§å’Œæ€§èƒ½ã€‚