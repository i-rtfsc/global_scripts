# Global Scripts V3 ç³»ç»Ÿæ¶æ„è®¾è®¡

## ğŸ“ æ¶æ„æ¦‚è¿°

### 1.1 è®¾è®¡ç†å¿µ
Global Scripts V3 é‡‡ç”¨ç°ä»£åŒ–çš„åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œå»é™¤V2å…¼å®¹æ€§åŒ…è¢±ï¼Œä¿ç•™ `custom/global_scripts-refactor-fail` ä¸­çš„ä¼˜ç§€æ¶æ„æ€æƒ³ï¼Œæ‰“é€ ç®€æ´é«˜æ•ˆçš„Shellå¼€å‘å·¥å…·æ¡†æ¶ã€‚

### 1.2 æ ¸å¿ƒåŸåˆ™
- **ç®€æ´æ€§ä¼˜å…ˆ**: ä¾èµ–æœ€å°åŒ–ï¼Œåªéœ€shell/pythonç¯å¢ƒ
- **åˆ†å±‚è§£è€¦**: æ¸…æ™°çš„å±‚æ¬¡è¾¹ç•Œï¼Œå•å‘ä¾èµ–å…³ç³»
- **æ’ä»¶åŒ–æ‰©å±•**: ç±»ä¼¼oh-my-zshçš„æœ¬åœ°æ’ä»¶æœºåˆ¶
- **é…ç½®é©±åŠ¨**: JSON Schemaé©±åŠ¨çš„ç°ä»£åŒ–é…ç½®ç®¡ç†
- **æ€§èƒ½å¯¼å‘**: å¯åŠ¨å¿«é€Ÿï¼Œè¿è¡Œé«˜æ•ˆï¼Œç¼“å­˜ä¼˜åŒ–

## ğŸ—ï¸ äº”å±‚æ¶æ„è®¾è®¡

### 2.1 æ¶æ„å±‚æ¬¡å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               ç”¨æˆ·æ¥å£å±‚ (User Interface Layer)       â”‚
â”‚                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ CLIå‘½ä»¤æ¥å£ â”‚ â”‚ Tabè¡¥å…¨ç³»ç»Ÿ â”‚ â”‚ å¸®åŠ©æ–‡æ¡£    â”‚    â”‚
â”‚  â”‚             â”‚ â”‚             â”‚ â”‚             â”‚    â”‚
â”‚  â”‚ â€¢ gs-*å‘½ä»¤  â”‚ â”‚ â€¢ æ™ºèƒ½è¡¥å…¨  â”‚ â”‚ â€¢ åˆ†å±‚å¸®åŠ©  â”‚    â”‚
â”‚  â”‚ â€¢ å‚æ•°è§£æ  â”‚ â”‚ â€¢ å†å²è®°å½•  â”‚ â”‚ â€¢ ç¤ºä¾‹å±•ç¤º  â”‚    â”‚
â”‚  â”‚ â€¢ æ ¼å¼è¾“å‡º  â”‚ â”‚ â€¢ ç¼“å­˜ä¼˜åŒ–  â”‚ â”‚ â€¢ æœç´¢åŠŸèƒ½  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚               å‘½ä»¤å¤„ç†å±‚ (Command Processing Layer)   â”‚
â”‚                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ å‘½ä»¤è·¯ç”±å™¨  â”‚ â”‚ å‚æ•°å¤„ç†å™¨  â”‚ â”‚ ç»“æœæ ¼å¼åŒ–  â”‚    â”‚
â”‚  â”‚             â”‚ â”‚             â”‚ â”‚             â”‚    â”‚
â”‚  â”‚ â€¢ åŠ¨æ€åˆ†å‘  â”‚ â”‚ â€¢ ç±»å‹è½¬æ¢  â”‚ â”‚ â€¢ JSONè¾“å‡º  â”‚    â”‚
â”‚  â”‚ â€¢ åˆ«åå±•å¼€  â”‚ â”‚ â€¢ éªŒè¯æ£€æŸ¥  â”‚ â”‚ â€¢ è¡¨æ ¼æ ¼å¼  â”‚    â”‚
â”‚  â”‚ â€¢ æƒé™æ£€æŸ¥  â”‚ â”‚ â€¢ é»˜è®¤å€¼   â”‚ â”‚ â€¢ ç®¡é“æ”¯æŒ  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                æ’ä»¶æœåŠ¡å±‚ (Plugin Service Layer)      â”‚
â”‚                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ æ’ä»¶ç®¡ç†å™¨  â”‚ â”‚ æ’ä»¶åŠ è½½å™¨  â”‚ â”‚ æ’ä»¶API    â”‚    â”‚
â”‚  â”‚             â”‚ â”‚             â”‚ â”‚             â”‚    â”‚
â”‚  â”‚ â€¢ å‘ç°æ‰«æ  â”‚ â”‚ â€¢ æ‡’åŠ è½½    â”‚ â”‚ â€¢ ç»Ÿä¸€æ¥å£  â”‚    â”‚
â”‚  â”‚ â€¢ çŠ¶æ€ç®¡ç†  â”‚ â”‚ â€¢ ä¾èµ–è§£æ  â”‚ â”‚ â€¢ é’©å­ç³»ç»Ÿ  â”‚    â”‚
â”‚  â”‚ â€¢ å¯ç”¨ç¦ç”¨  â”‚ â”‚ â€¢ æ²™ç®±æ‰§è¡Œ  â”‚ â”‚ â€¢ äº‹ä»¶é€šçŸ¥  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              æ ¸å¿ƒæœåŠ¡å±‚ (Core Service Layer)          â”‚
â”‚                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ é…ç½®ç®¡ç†    â”‚ â”‚ ç¼“å­˜ç³»ç»Ÿ    â”‚ â”‚ æ€§èƒ½ç›‘æ§    â”‚    â”‚
â”‚  â”‚             â”‚ â”‚             â”‚ â”‚             â”‚    â”‚
â”‚  â”‚ â€¢ JSONé…ç½®  â”‚ â”‚ â€¢ L1å†…å­˜ç¼“å­˜â”‚ â”‚ â€¢ å¯åŠ¨ç›‘æ§  â”‚    â”‚
â”‚  â”‚ â€¢ SchemaéªŒè¯â”‚ â”‚ â€¢ L2ç£ç›˜ç¼“å­˜â”‚ â”‚ â€¢ æ€§èƒ½ç»Ÿè®¡  â”‚    â”‚
â”‚  â”‚ â€¢ çƒ­é‡è½½    â”‚ â”‚ â€¢ ç¼“å­˜ç­–ç•¥  â”‚ â”‚ â€¢ ç“¶é¢ˆåˆ†æ  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              åŸºç¡€è®¾æ–½å±‚ (Infrastructure Layer)        â”‚
â”‚                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ æ—¥å¿—ç³»ç»Ÿ    â”‚ â”‚ é”™è¯¯å¤„ç†    â”‚ â”‚ å·¥å…·åº“      â”‚    â”‚
â”‚  â”‚             â”‚ â”‚             â”‚ â”‚             â”‚    â”‚
â”‚  â”‚ â€¢ å¤šçº§æ—¥å¿—  â”‚ â”‚ â€¢ ç»Ÿä¸€é”™è¯¯  â”‚ â”‚ â€¢ è·¨å¹³å°    â”‚    â”‚
â”‚  â”‚ â€¢ å½©è‰²è¾“å‡º  â”‚ â”‚ â€¢ é”™è¯¯æ¢å¤  â”‚ â”‚ â€¢ å·¥å…·å‡½æ•°  â”‚    â”‚
â”‚  â”‚ â€¢ æ–‡ä»¶è½®è½¬  â”‚ â”‚ â€¢ è¯Šæ–­å»ºè®®  â”‚ â”‚ â€¢ ç³»ç»Ÿæ£€æµ‹  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 å±‚æ¬¡èŒè´£å®šä¹‰

#### ç”¨æˆ·æ¥å£å±‚ (User Interface Layer)
**èŒè´£**: æä¾›ç”¨æˆ·äº¤äº’æ¥å£ï¼Œå¤„ç†ç”¨æˆ·è¾“å…¥è¾“å‡º
- **CLIå‘½ä»¤æ¥å£**: å®ç°æ‰€æœ‰ `gs-*` å‘½ä»¤çš„ç”¨æˆ·æ¥å£
- **Tabè¡¥å…¨ç³»ç»Ÿ**: æ™ºèƒ½çš„å‘½ä»¤å’Œå‚æ•°è¡¥å…¨åŠŸèƒ½
- **å¸®åŠ©æ–‡æ¡£ç³»ç»Ÿ**: åˆ†å±‚æ¬¡çš„å¸®åŠ©ä¿¡æ¯å’Œç¤ºä¾‹å±•ç¤º

#### å‘½ä»¤å¤„ç†å±‚ (Command Processing Layer)  
**èŒè´£**: å¤„ç†å‘½ä»¤è§£æã€éªŒè¯å’Œç»“æœæ ¼å¼åŒ–
- **å‘½ä»¤è·¯ç”±å™¨**: æ ¹æ®å‘½ä»¤åç§°åˆ†å‘åˆ°å¯¹åº”çš„å¤„ç†å‡½æ•°
- **å‚æ•°å¤„ç†å™¨**: è§£æã€è½¬æ¢å’ŒéªŒè¯å‘½ä»¤å‚æ•°
- **ç»“æœæ ¼å¼åŒ–å™¨**: å°†æ‰§è¡Œç»“æœæ ¼å¼åŒ–ä¸ºç”¨æˆ·å‹å¥½çš„è¾“å‡º

#### æ’ä»¶æœåŠ¡å±‚ (Plugin Service Layer)
**èŒè´£**: ç®¡ç†æ’ä»¶ç”Ÿå‘½å‘¨æœŸï¼Œæä¾›æ’ä»¶è¿è¡Œç¯å¢ƒ
- **æ’ä»¶ç®¡ç†å™¨**: å‘ç°ã€å¯ç”¨ã€ç¦ç”¨æ’ä»¶ï¼Œç®¡ç†æ’ä»¶çŠ¶æ€
- **æ’ä»¶åŠ è½½å™¨**: æ‡’åŠ è½½æ’ä»¶ï¼Œè§£æä¾èµ–å…³ç³»
- **æ’ä»¶API**: ä¸ºæ’ä»¶æä¾›ç»Ÿä¸€çš„æ¥å£å’Œé’©å­ç³»ç»Ÿ

#### æ ¸å¿ƒæœåŠ¡å±‚ (Core Service Layer)
**èŒè´£**: æä¾›ç³»ç»Ÿæ ¸å¿ƒæœåŠ¡å’ŒåŸºç¡€åŠŸèƒ½
- **é…ç½®ç®¡ç†**: JSON Schemaé©±åŠ¨çš„é…ç½®ç³»ç»Ÿ
- **ç¼“å­˜ç³»ç»Ÿ**: åŒçº§ç¼“å­˜ä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½
- **æ€§èƒ½ç›‘æ§**: ç›‘æ§ç³»ç»Ÿæ€§èƒ½ï¼Œæä¾›ä¼˜åŒ–å»ºè®®

#### åŸºç¡€è®¾æ–½å±‚ (Infrastructure Layer)
**èŒè´£**: æä¾›åº•å±‚æŠ€æœ¯æœåŠ¡å’Œè·¨å¹³å°æ”¯æŒ
- **æ—¥å¿—ç³»ç»Ÿ**: ç»“æ„åŒ–æ—¥å¿—è®°å½•å’Œç®¡ç†
- **é”™è¯¯å¤„ç†**: ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å’Œæ¢å¤æœºåˆ¶
- **å·¥å…·åº“**: é€šç”¨å·¥å…·å‡½æ•°å’Œè·¨å¹³å°é€‚é…

## ğŸ”§ æŠ€æœ¯æ ˆæ¶æ„

### 3.1 Shell+Pythonæ··åˆæŠ€æœ¯æ ˆ

#### æŠ€æœ¯æ ˆåˆ†å·¥ç­–ç•¥
```bash
# æŠ€æœ¯æ ˆåˆ†å·¥åŸåˆ™
technology_stack_division() {
    # Shellè´Ÿè´£çš„åŠŸèƒ½é¢†åŸŸ
    shell_responsibilities=(
        "ç³»ç»Ÿç¯å¢ƒæ£€æµ‹"           # æ£€æµ‹OSã€Shellã€ç¡¬ä»¶ä¿¡æ¯
        "æ–‡ä»¶æƒé™å’Œè·¯å¾„æ“ä½œ"     # æ–‡ä»¶ç³»ç»Ÿæ“ä½œã€æƒé™ç®¡ç†
        "è¿›ç¨‹ç®¡ç†å’Œå‘½ä»¤æ‰§è¡Œ"     # è¿›ç¨‹æ§åˆ¶ã€å‘½ä»¤è°ƒç”¨
        "ç®€å•çš„æ–‡æœ¬å¤„ç†"         # åŸºç¡€å­—ç¬¦ä¸²æ“ä½œã€ç®¡é“å¤„ç†
        "ç”¨æˆ·æ¥å£å±•ç¤º"           # ç»ˆç«¯è¾“å‡ºã€äº¤äº’ç•Œé¢
        "ç¯å¢ƒå˜é‡ç®¡ç†"           # ç¯å¢ƒå˜é‡è®¾ç½®å’Œè·å–
    )
    
    # Pythonè´Ÿè´£çš„åŠŸèƒ½é¢†åŸŸ  
    python_responsibilities=(
        "JSONé…ç½®æ–‡ä»¶è§£æå’ŒéªŒè¯" # JSONå¤„ç†ã€SchemaéªŒè¯
        "å…³è”æ•°ç»„/å­—å…¸æ“ä½œ"     # å¤æ‚æ•°æ®ç»“æ„å¤„ç†
        "å¤æ‚çš„å­—ç¬¦ä¸²å¤„ç†å’Œæ­£åˆ™" # é«˜çº§æ–‡æœ¬å¤„ç†ã€æ¨¡å¼åŒ¹é…
        "æ•°æ®éªŒè¯å’Œè½¬æ¢"         # æ•°æ®ç±»å‹è½¬æ¢ã€æ ¼å¼éªŒè¯
        "é…ç½®æ¨¡æ¿æ¸²æŸ“"           # æ¨¡æ¿å¼•æ“ã€é…ç½®ç”Ÿæˆ
        "å¤æ‚ç®—æ³•å®ç°"           # æ•°å­¦è®¡ç®—ã€ç®—æ³•é€»è¾‘
        "ä¾èµ–å…³ç³»è§£æ"           # æ’ä»¶ä¾èµ–ã€æ‹“æ‰‘æ’åº
        "æ€§èƒ½æ•°æ®åˆ†æ"           # æ€§èƒ½ç»Ÿè®¡ã€æ•°æ®åˆ†æ
    )
}
```

#### Pythonå…¼å®¹æ€§æ¶æ„
```bash
# Pythonç¯å¢ƒæ£€æµ‹å’Œå…¼å®¹ (lib/python_compat.sh)
detect_python_environment() {
    local python_cmd=""
    
    # ä¼˜å…ˆçº§æ£€æµ‹ï¼špython3 > python > python2
    if command -v python3 >/dev/null 2>&1; then
        python_cmd="python3"
        _GS_PYTHON_VERSION="3"
    elif command -v python >/dev/null 2>&1; then
        # æ£€æŸ¥pythonç‰ˆæœ¬
        local version=$(python -c "import sys; print(sys.version_info[0])" 2>/dev/null)
        if [[ "$version" == "3" ]]; then
            python_cmd="python"
            _GS_PYTHON_VERSION="3"
        elif [[ "$version" == "2" ]]; then
            python_cmd="python"
            _GS_PYTHON_VERSION="2"
        fi
    elif command -v python2 >/dev/null 2>&1; then
        python_cmd="python2"
        _GS_PYTHON_VERSION="2"
    fi
    
    # è®¾ç½®å…¨å±€Pythonå‘½ä»¤
    _GS_PYTHON_CMD="$python_cmd"
    
    # æ£€æµ‹åŸºæœ¬åŠŸèƒ½å¯ç”¨æ€§
    if [[ -n "$_GS_PYTHON_CMD" ]]; then
        test_python_json_support
        test_python_unicode_support
    fi
}

# Pythonè¾…åŠ©è„šæœ¬è°ƒç”¨æ¥å£
call_python_helper() {
    local operation="$1"
    shift
    local args=("$@")
    
    if [[ -n "$_GS_PYTHON_CMD" ]]; then
        # è°ƒç”¨Pythonè¾…åŠ©è„šæœ¬
        $_GS_PYTHON_CMD "$_GS_ROOT/lib/gs_helper.py" "$operation" "${args[@]}"
        local exit_code=$?
        
        # Pythonæ‰§è¡ŒæˆåŠŸåˆ™è¿”å›
        [[ $exit_code -eq 0 ]] && return 0
    fi
    
    # Pythonä¸å¯ç”¨æˆ–æ‰§è¡Œå¤±è´¥ï¼Œé™çº§åˆ°Shellå®ç°
    fallback_to_shell_implementation "$operation" "${args[@]}"
}
```

#### Pythonè¾…åŠ©è„šæœ¬æ¶æ„ (lib/gs_helper.py)
```python
#!/usr/bin/env python
# -*- coding: utf-8 -*-
"""
Global Scripts V3 - Pythonè¾…åŠ©è„šæœ¬
å…¼å®¹Python 2.7å’ŒPython 3.x
"""
from __future__ import print_function, unicode_literals
import sys
import json
import os
import re

# Python 2/3å…¼å®¹æ€§å¤„ç†
if sys.version_info[0] == 2:
    import codecs
    def open_file(filename, mode='r', encoding='utf-8'):
        return codecs.open(filename, mode, encoding=encoding)
    string_types = (str, unicode)
else:
    def open_file(filename, mode='r', encoding='utf-8'):
        return open(filename, mode, encoding=encoding)
    string_types = (str,)

class GlobalScriptsHelper:
    """Pythonè¾…åŠ©åŠŸèƒ½ç±»"""
    
    def json_get(self, file_path, key, default=""):
        """è·å–JSONé…ç½®å€¼"""
        try:
            with open_file(file_path, 'r') as f:
                data = json.load(f)
            
            # æ”¯æŒåµŒå¥—é”®è®¿é—®ï¼Œå¦‚ "database.host"
            keys = key.split('.')
            value = data
            for k in keys:
                if isinstance(value, dict) and k in value:
                    value = value[k]
                else:
                    value = default
                    break
            
            print(self._safe_str(value))
            return 0
        except Exception as e:
            print("", file=sys.stderr)
            return 1
    
    def json_set(self, file_path, key, value):
        """è®¾ç½®JSONé…ç½®å€¼"""
        try:
            # è¯»å–ç°æœ‰é…ç½®
            data = {}
            if os.path.exists(file_path):
                with open_file(file_path, 'r') as f:
                    data = json.load(f)
            
            # è®¾ç½®åµŒå¥—é”®å€¼
            keys = key.split('.')
            current = data
            for k in keys[:-1]:
                if k not in current:
                    current[k] = {}
                current = current[k]
            
            # ç±»å‹è½¬æ¢
            current[keys[-1]] = self._convert_value(value)
            
            # å†™å›æ–‡ä»¶
            with open_file(file_path, 'w') as f:
                json.dump(data, f, indent=2, ensure_ascii=False)
            
            print("Configuration updated successfully")
            return 0
        except Exception as e:
            print("Error: " + str(e), file=sys.stderr)
            return 1
    
    def validate_json(self, file_path, schema_file=None):
        """éªŒè¯JSONæ ¼å¼å’ŒSchema"""
        try:
            with open_file(file_path, 'r') as f:
                data = json.load(f)
            
            # åŸºç¡€JSONæ ¼å¼éªŒè¯é€šè¿‡
            if schema_file and os.path.exists(schema_file):
                # å°è¯•SchemaéªŒè¯ï¼ˆå¦‚æœæœ‰jsonschemaåº“ï¼‰
                try:
                    import jsonschema
                    with open_file(schema_file, 'r') as f:
                        schema = json.load(f)
                    jsonschema.validate(data, schema)
                    print("JSON validation passed with schema")
                except ImportError:
                    print("JSON format valid (jsonschema not available)")
                except jsonschema.ValidationError as e:
                    print("Schema validation failed: " + str(e), file=sys.stderr)
                    return 1
            else:
                print("JSON format valid")
            
            return 0
        except Exception as e:
            print("JSON validation failed: " + str(e), file=sys.stderr)
            return 1
    
    def array_operations(self, operation, *args):
        """å…³è”æ•°ç»„/å­—å…¸æ“ä½œ"""
        try:
            if operation == "merge":
                # åˆå¹¶å¤šä¸ªJSONæ–‡ä»¶
                result = {}
                for file_path in args:
                    with open_file(file_path, 'r') as f:
                        data = json.load(f)
                    result.update(data)
                print(json.dumps(result, indent=2, ensure_ascii=False))
                
            elif operation == "keys":
                # è·å–æ‰€æœ‰é”®
                file_path = args[0]
                with open_file(file_path, 'r') as f:
                    data = json.load(f)
                if isinstance(data, dict):
                    for key in data.keys():
                        print(key)
                        
            elif operation == "filter":
                # æ ¹æ®æ¨¡å¼è¿‡æ»¤é”®å€¼å¯¹
                file_path, pattern = args[0], args[1]
                with open_file(file_path, 'r') as f:
                    data = json.load(f)
                
                regex = re.compile(pattern)
                filtered = {k: v for k, v in data.items() if regex.search(k)}
                print(json.dumps(filtered, indent=2, ensure_ascii=False))
            
            return 0
        except Exception as e:
            print("Array operation failed: " + str(e), file=sys.stderr)
            return 1
    
    def _safe_str(self, value):
        """å®‰å…¨çš„å­—ç¬¦ä¸²è½¬æ¢ï¼Œå…¼å®¹py2/py3"""
        if isinstance(value, string_types):
            return value
        return str(value)
    
    def _convert_value(self, value):
        """æ™ºèƒ½ç±»å‹è½¬æ¢"""
        # å°è¯•è½¬æ¢ä¸ºæ•°å­—
        try:
            if '.' in value:
                return float(value)
            return int(value)
        except ValueError:
            pass
        
        # å°è¯•è½¬æ¢ä¸ºå¸ƒå°”å€¼
        if value.lower() in ('true', 'false'):
            return value.lower() == 'true'
        
        # å°è¯•è½¬æ¢ä¸ºJSON
        try:
            return json.loads(value)
        except ValueError:
            pass
        
        # é»˜è®¤è¿”å›å­—ç¬¦ä¸²
        return value

def main():
    """ä¸»å…¥å£å‡½æ•°"""
    if len(sys.argv) < 2:
        print("Usage: gs_helper.py <operation> [args...]", file=sys.stderr)
        sys.exit(1)
    
    helper = GlobalScriptsHelper()
    operation = sys.argv[1]
    args = sys.argv[2:]
    
    # å‘½ä»¤åˆ†å‘
    method_map = {
        'json_get': helper.json_get,
        'json_set': helper.json_set,
        'validate_json': helper.validate_json,
        'array_operations': helper.array_operations,
    }
    
    if operation in method_map:
        try:
            exit_code = method_map[operation](*args)
            sys.exit(exit_code)
        except Exception as e:
            print("Error: " + str(e), file=sys.stderr)
            sys.exit(1)
    else:
        print("Unknown operation: " + operation, file=sys.stderr)
        sys.exit(1)

if __name__ == '__main__':
    main()
```

#### Shell+Pythonåä½œç¤ºä¾‹
```bash
# é…ç½®ç®¡ç†æ¨¡å—ä½¿ç”¨ç¤ºä¾‹ (core/config.sh)
gs_config_get() {
    local key="$1"
    local default_value="${2:-}"
    local config_file="${3:-$_GS_CONFIG_USER_FILE}"
    
    # ä¼˜å…ˆä½¿ç”¨Pythonå¤„ç†JSON
    if [[ -n "$_GS_PYTHON_CMD" ]]; then
        local result
        result=$(call_python_helper "json_get" "$config_file" "$key" "$default_value" 2>/dev/null)
        local exit_code=$?
        
        if [[ $exit_code -eq 0 && -n "$result" ]]; then
            echo "$result"
            return 0
        fi
    fi
    
    # é™çº§åˆ°Shell+jqå®ç°
    if command -v jq >/dev/null 2>&1; then
        local value
        value=$(jq -r ".$key // \"$default_value\"" "$config_file" 2>/dev/null)
        echo "$value"
        return 0
    fi
    
    # æœ€åé™çº§åˆ°çº¯Shellå®ç°
    echo "$default_value"
    return 1
}

# å…³è”æ•°ç»„æ“ä½œç¤ºä¾‹
gs_plugin_resolve_dependencies() {
    local plugin_manifests=("$@")
    
    # ä½¿ç”¨Pythonå¤„ç†å¤æ‚çš„ä¾èµ–è§£æ
    if [[ -n "$_GS_PYTHON_CMD" ]]; then
        local temp_file=$(mktemp)
        
        # åˆ›å»ºä¾èµ–æ•°æ®JSON
        echo '{"plugins": [' > "$temp_file"
        local first=true
        for manifest in "${plugin_manifests[@]}"; do
            [[ "$first" == "true" ]] && first=false || echo ',' >> "$temp_file"
            cat "$manifest" >> "$temp_file"
        done
        echo ']}' >> "$temp_file"
        
        # è°ƒç”¨Pythonè¿›è¡Œæ‹“æ‰‘æ’åº
        local sorted_result
        sorted_result=$(call_python_helper "dependency_sort" "$temp_file" 2>/dev/null)
        
        rm -f "$temp_file"
        
        if [[ $? -eq 0 && -n "$sorted_result" ]]; then
            echo "$sorted_result"
            return 0
        fi
    fi
    
    # é™çº§åˆ°ç®€å•çš„Shellå®ç°
    printf '%s\n' "${plugin_manifests[@]}"
}
```

è¿™ä¸ªæ··åˆæ¶æ„çš„æ ¸å¿ƒä¼˜åŠ¿ï¼š
1. **æ€§èƒ½ä¼˜åŒ–**: Pythonå¤„ç†å¤æ‚é€»è¾‘ï¼ŒShellå¤„ç†ç³»ç»Ÿè°ƒç”¨
2. **å…¼å®¹æ€§å¥½**: è‡ªåŠ¨é€‚é…py2/py3ï¼Œæä¾›Shellé™çº§
3. **åŠŸèƒ½å¼ºå¤§**: åˆ©ç”¨Pythonä¸°å¯Œçš„åº“å¤„ç†å¤æ‚æ•°æ®
4. **æ¥å£ç»Ÿä¸€**: Shellå‡½æ•°æ¥å£ä¿æŒä¸å˜ï¼Œç”¨æˆ·æ— æ„ŸçŸ¥
5. **æ˜“äºç»´æŠ¤**: å„è‡ªå‘æŒ¥è¯­è¨€ä¼˜åŠ¿ï¼Œä»£ç æ›´æ¸…æ™°

#### ç³»ç»Ÿå·¥å…·å±‚ (æ ‡å‡†å·¥å…·)
```bash
# å¿…éœ€çš„ç³»ç»Ÿå·¥å…·
required_tools=(
    "jq"            # JSONå¤„ç†
    "curl"          # HTTPè¯·æ±‚
    "git"           # ç‰ˆæœ¬æ§åˆ¶
    "grep/sed/awk"  # æ–‡æœ¬å¤„ç†
)

# å¯é€‰çš„å¢å¼ºå·¥å…·
optional_tools=(
    "fzf"           # æ¨¡ç³Šæœç´¢
    "bat"           # è¯­æ³•é«˜äº®
    "fd"            # å¿«é€Ÿæ–‡ä»¶æŸ¥æ‰¾
    "ripgrep"       # å¿«é€Ÿæ–‡æœ¬æœç´¢
)
```

### 3.2 å¯é€‰é«˜æ€§èƒ½æ’ä»¶

#### Goè¯­è¨€æ’ä»¶ (å¯é€‰)
```bash
# Goæ’ä»¶ç¤ºä¾‹
go_plugins=(
    "gs-performance-monitor"    # é«˜æ€§èƒ½ç›‘æ§æ’ä»¶
    "gs-cache-engine"          # é«˜é€Ÿç¼“å­˜å¼•æ“
    "gs-concurrent-executor"   # å¹¶å‘æ‰§è¡Œå¼•æ“
)

# å®‰è£…æ–¹å¼
install_go_plugin() {
    echo "æ£€æµ‹åˆ°Goç¯å¢ƒï¼Œå®‰è£…é«˜æ€§èƒ½æ’ä»¶..."
    go install github.com/globalscripts/performance-monitor@latest
}
```

#### Rustè¯­è¨€æ’ä»¶ (å¯é€‰)
```bash
# Rustæ’ä»¶ç¤ºä¾‹
rust_plugins=(
    "gs-security-sandbox"      # å®‰å…¨æ²™ç®±æ’ä»¶
    "gs-system-monitor"        # ç³»ç»Ÿç›‘æ§æ’ä»¶
    "gs-crypto-tools"          # åŠ å¯†å·¥å…·æ’ä»¶
)

# å®‰è£…æ–¹å¼
install_rust_plugin() {
    echo "æ£€æµ‹åˆ°Rustç¯å¢ƒï¼Œå®‰è£…å®‰å…¨å¢å¼ºæ’ä»¶..."
    cargo install gs-security-sandbox
}
```

### 3.3 ä¾èµ–ç®¡ç†ç­–ç•¥

#### åˆ†å±‚ä¾èµ–æ£€æŸ¥
```bash
# ä¾èµ–æ£€æŸ¥å‡½æ•°
check_dependencies() {
    local level="$1"
    
    case "$level" in
        "required")
            check_required_dependencies
            ;;
        "optional")
            check_optional_dependencies
            ;;
        "plugin")
            check_plugin_dependencies
            ;;
    esac
}

# å¿…éœ€ä¾èµ–æ£€æŸ¥
check_required_dependencies() {
    local missing_deps=()
    
    # æ£€æŸ¥Shellç¯å¢ƒ
    if [[ -z "$BASH_VERSION" && -z "$ZSH_VERSION" ]]; then
        missing_deps+=("bashæˆ–zsh")
    fi
    
    # æ£€æŸ¥Pythonç¯å¢ƒ
    if ! command -v python3 &>/dev/null; then
        missing_deps+=("python3")
    fi
    
    # æ£€æŸ¥jq
    if ! command -v jq &>/dev/null; then
        missing_deps+=("jq")
    fi
    
    if [[ ${#missing_deps[@]} -gt 0 ]]; then
        echo "é”™è¯¯: ç¼ºå°‘å¿…éœ€ä¾èµ–: ${missing_deps[*]}"
        return 1
    fi
}
```

## ğŸ“¦ æ¨¡å—è®¾è®¡

### 4.1 æ ¸å¿ƒæ¨¡å—æ¶æ„

#### ç³»ç»Ÿå¼•å¯¼æ¨¡å— (core/bootstrap.sh)
```bash
# å¼•å¯¼æµç¨‹è®¾è®¡
bootstrap_sequence() {
    # 1. ç¯å¢ƒæ£€æµ‹
    detect_environment
    
    # 2. ä¾èµ–æ£€æŸ¥
    check_dependencies "required"
    
    # 3. æ€§èƒ½ç›‘æ§å¯åŠ¨
    start_performance_monitoring
    
    # 4. é…ç½®ç³»ç»Ÿåˆå§‹åŒ–
    initialize_configuration
    
    # 5. ç¼“å­˜ç³»ç»Ÿå¯åŠ¨
    initialize_cache_system
    
    # 6. æ’ä»¶ç³»ç»Ÿåˆå§‹åŒ–
    initialize_plugin_system
    
    # 7. å‘½ä»¤æ³¨å†Œ
    register_core_commands
    
    # 8. å®Œæˆå¯åŠ¨
    finalize_bootstrap
}

# ç¯å¢ƒæ£€æµ‹
detect_environment() {
    # æ£€æµ‹æ“ä½œç³»ç»Ÿ
    detect_os_type
    
    # æ£€æµ‹Shellç±»å‹
    detect_shell_type
    
    # æ£€æµ‹Pythonç‰ˆæœ¬
    detect_python_version
    
    # è®¾ç½®ç¯å¢ƒå˜é‡
    setup_environment_variables
}
```

#### é…ç½®ç®¡ç†æ¨¡å— (core/config.sh)
```bash
# é…ç½®ç³»ç»Ÿæ¶æ„
config_system_architecture() {
    # é…ç½®æ–‡ä»¶å±‚æ¬¡
    configuration_hierarchy=(
        "$HOME/.gs/config.json"         # ç”¨æˆ·é…ç½®
        "$GS_ROOT/config/default.json"  # é»˜è®¤é…ç½®
        "$GS_ROOT/config/system.json"   # ç³»ç»Ÿé…ç½®
    )
    
    # é…ç½®åˆå¹¶ç­–ç•¥
    merge_strategy="user_override_default"
    
    # é…ç½®éªŒè¯
    schema_validation="enabled"
    
    # é…ç½®ç¼“å­˜
    config_cache="memory_cache_with_file_watch"
}

# é…ç½®APIè®¾è®¡
declare -gA GS_CONFIG_CACHE=()

gs_config_get() {
    local key="$1"
    local default_value="$2"
    
    # æ£€æŸ¥ç¼“å­˜
    if [[ -n "${GS_CONFIG_CACHE[$key]}" ]]; then
        echo "${GS_CONFIG_CACHE[$key]}"
        return 0
    fi
    
    # ä»é…ç½®æ–‡ä»¶è¯»å–
    local value
    value=$(jq -r ".$key // empty" "$HOME/.gs/config.json" 2>/dev/null)
    
    if [[ -n "$value" && "$value" != "null" ]]; then
        # æ›´æ–°ç¼“å­˜
        GS_CONFIG_CACHE[$key]="$value"
        echo "$value"
    else
        echo "$default_value"
    fi
}
```

#### æ’ä»¶ç®¡ç†æ¨¡å— (core/loader.sh)
```bash
# æ’ä»¶ç³»ç»Ÿæ¶æ„
plugin_system_architecture() {
    # æ’ä»¶å‘ç°è·¯å¾„
    plugin_paths=(
        "$GS_ROOT/plugins"              # å†…ç½®æ’ä»¶
        "$HOME/.gs/custom"              # ç”¨æˆ·è‡ªå®šä¹‰æ’ä»¶
    )
    
    # æ’ä»¶åŠ è½½ç­–ç•¥
    loading_strategy="lazy_loading_with_dependency_resolution"
    
    # æ’ä»¶çŠ¶æ€ç®¡ç†
    state_management="in_memory_with_persistence"
    
    # æ’ä»¶æ²™ç®±
    sandbox_mode="lightweight_isolation"
}

# æ’ä»¶å‘ç°å’Œæ³¨å†Œ
declare -gA GS_PLUGIN_REGISTRY=()
declare -gA GS_PLUGIN_MANIFESTS=()
declare -gA GS_PLUGIN_STATE=()

gs_plugin_discover() {
    local plugin_dir="$1"
    local manifest_file="$plugin_dir/manifest.json"
    
    # æ£€æŸ¥manifestæ–‡ä»¶
    [[ -f "$manifest_file" ]] || return 1
    
    # éªŒè¯manifestæ ¼å¼
    if ! jq -e . "$manifest_file" >/dev/null 2>&1; then
        gs_log "WARN" "æ’ä»¶manifestæ ¼å¼é”™è¯¯: $manifest_file"
        return 1
    fi
    
    # æå–æ’ä»¶ä¿¡æ¯
    local plugin_name
    plugin_name=$(jq -r '.name' "$manifest_file")
    
    # æ³¨å†Œæ’ä»¶
    GS_PLUGIN_REGISTRY["$plugin_name"]="$plugin_dir"
    GS_PLUGIN_MANIFESTS["$plugin_name"]="$manifest_file"
    GS_PLUGIN_STATE["$plugin_name"]="discovered"
    
    gs_log "DEBUG" "å‘ç°æ’ä»¶: $plugin_name"
}
```

### 4.2 æ’ä»¶æ¶æ„è®¾è®¡

#### åˆ†å±‚æ’ä»¶Manifestè§„èŒƒ
```json
{
  "$schema": "https://globalscripts.dev/schema/plugin-manifest-v3.json",
  "name": "android",
  "version": "3.0.0",
  "description": "Androidå¼€å‘å·¥å…·é›†",
  "type": "main",
  "author": {
    "name": "Global Scripts",
    "email": "dev@globalscripts.dev"
  },
  "main": "android.sh",
  "dependencies": {
    "system": ["adb", "fastboot"],
    "plugins": [],
    "python": []
  },
  "submodules": {
    "adb": {
      "name": "Android Debug Bridge",
      "description": "ADBå·¥å…·é›†",
      "manifest": "adb/manifest.json",
      "main": "adb/adb_tools.sh"
    },
    "fastboot": {
      "name": "Android Fastboot",
      "description": "Fastbootåˆ·æœºå·¥å…·",
      "manifest": "fastboot/manifest.json", 
      "main": "fastboot/fastboot_tools.sh"
    },
    "perfetto": {
      "name": "Android Performance Analysis",
      "description": "Androidç³»ç»Ÿæ€§èƒ½åˆ†æå·¥å…·",
      "manifest": "perfetto/manifest.json",
      "main": "perfetto/perfetto_tools.sh"
    }
  },
  "commands": {
    "gs-android-device-list": {
      "function": "android_device_list",
      "description": "åˆ—å‡ºè¿æ¥çš„Androidè®¾å¤‡",
      "module": "main",
      "aliases": ["adl"]
    },
    "gs-android-adb-shell": {
      "function": "adb_shell_connect", 
      "description": "è¿æ¥ADB Shell",
      "module": "adb",
      "aliases": ["ash"]
    },
    "gs-android-fastboot-devices": {
      "function": "fastboot_list_devices",
      "description": "åˆ—å‡ºFastbootè®¾å¤‡",
      "module": "fastboot",
      "aliases": ["fbd"]
    }
  },
  "config": {
    "android.adb_timeout": {
      "type": "integer",
      "default": 30,
      "description": "ADBå‘½ä»¤è¶…æ—¶æ—¶é—´(ç§’)"
    },
    "android.fastboot_timeout": {
      "type": "integer", 
      "default": 60,
      "description": "Fastbootå‘½ä»¤è¶…æ—¶æ—¶é—´(ç§’)"
    }
  },
  "completion": {
    "auto_generate": true,
    "custom_completion": "completion/android_completion.sh"
  },
  "hooks": {
    "on_load": "android_plugin_init",
    "on_unload": "android_plugin_cleanup",
    "on_config_change": "android_config_update"
  }
}
```

#### å­æ¨¡å—Manifestç¤ºä¾‹ (adb/manifest.json)
```json
{
  "$schema": "https://globalscripts.dev/schema/submodule-manifest-v3.json",
  "name": "adb",
  "parent": "android",
  "version": "3.0.0",
  "description": "Android Debug Bridgeå·¥å…·é›†",
  "type": "submodule",
  "main": "adb_tools.sh",
  "dependencies": {
    "system": ["adb"]
  },
  "commands": {
    "gs-android-adb-shell": {
      "function": "adb_shell_connect",
      "description": "è¿æ¥åˆ°è®¾å¤‡ADB Shell",
      "completion": "adb_shell_completion"
    },
    "gs-android-adb-install": {
      "function": "adb_install_apk", 
      "description": "å®‰è£…APKåˆ°è®¾å¤‡",
      "completion": "adb_install_completion"
    },
    "gs-android-adb-push": {
      "function": "adb_push_file",
      "description": "æ¨é€æ–‡ä»¶åˆ°è®¾å¤‡",
      "completion": "adb_push_completion"
    },
    "gs-android-adb-pull": {
      "function": "adb_pull_file",
      "description": "ä»è®¾å¤‡æ‹‰å–æ–‡ä»¶", 
      "completion": "adb_pull_completion"
    }
  },
  "config": {
    "adb.default_timeout": {
      "type": "integer",
      "default": 30,
      "description": "é»˜è®¤ADBæ“ä½œè¶…æ—¶æ—¶é—´"
    },
    "adb.preferred_device": {
      "type": "string",
      "default": "",
      "description": "é¦–é€‰è®¾å¤‡IDï¼ˆä¸ºç©ºæ—¶è‡ªåŠ¨é€‰æ‹©ï¼‰"
    }
  }
}
```

#### åˆ†å±‚æ’ä»¶ç®¡ç†ç³»ç»Ÿ
```bash
# æ’ä»¶ç›®å½•ç»“æ„ - æ”¯æŒå­æ¨¡å—åˆ†å±‚
plugins/
â”œâ”€â”€ android/                    # Androidå¼€å‘å·¥å…·æ’ä»¶
â”‚   â”œâ”€â”€ manifest.json          # ä¸»æ’ä»¶æ¸…å•
â”‚   â”œâ”€â”€ android.sh             # ä¸»å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ adb/                   # ADBå·¥å…·å­æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ manifest.json      # ADBå­æ¨¡å—æ¸…å•
â”‚   â”‚   â””â”€â”€ adb_tools.sh       # ADBåŠŸèƒ½å®ç°
â”‚   â”œâ”€â”€ fastboot/              # Fastbootå­æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ manifest.json
â”‚   â”‚   â””â”€â”€ fastboot_tools.sh
â”‚   â”œâ”€â”€ perfetto/              # æ€§èƒ½åˆ†æå­æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ manifest.json
â”‚   â”‚   â””â”€â”€ perfetto_tools.sh
â”‚   â””â”€â”€ README.md              # æ’ä»¶ä½¿ç”¨æ–‡æ¡£
â”œâ”€â”€ git/                       # Gitå¢å¼ºæ’ä»¶
â”‚   â”œâ”€â”€ manifest.json          # ä¸»æ’ä»¶æ¸…å•
â”‚   â”œâ”€â”€ git.sh                 # Gitä¸»å…¥å£
â”‚   â”œâ”€â”€ branch/                # åˆ†æ”¯ç®¡ç†å­æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ manifest.json
â”‚   â”‚   â””â”€â”€ branch_tools.sh
â”‚   â”œâ”€â”€ commit/                # æäº¤ç®¡ç†å­æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ manifest.json
â”‚   â”‚   â””â”€â”€ commit_tools.sh
â”‚   â””â”€â”€ README.md
â””â”€â”€ system/                    # ç³»ç»Ÿç®¡ç†æ’ä»¶
    â”œâ”€â”€ manifest.json          # ä¸»æ’ä»¶æ¸…å•
    â”œâ”€â”€ system.sh              # ç³»ç»Ÿä¸»å…¥å£
    â”œâ”€â”€ proxy/                 # ä»£ç†ç®¡ç†å­æ¨¡å—
    â”‚   â”œâ”€â”€ manifest.json
    â”‚   â””â”€â”€ proxy_tools.sh
    â”œâ”€â”€ network/               # ç½‘ç»œå·¥å…·å­æ¨¡å—
    â”‚   â”œâ”€â”€ manifest.json
    â”‚   â””â”€â”€ network_tools.sh
    â””â”€â”€ README.md

custom/ # æ ¹ç›®å½•çš„.gitignoreå¿½ç•¥æ‰è¿™ä¸ªç›®å½•
â”œâ”€â”€ README.md                  # æ’ä»¶å¼€å‘è¯´æ˜
â””â”€â”€ my_plugin/                 # ç”¨æˆ·æ’ä»¶ç¤ºä¾‹
    â”œâ”€â”€ manifest.json          # æ”¯æŒå­æ¨¡å—çš„æ’ä»¶æ¸…å•
    â”œâ”€â”€ my_plugin.sh           # ä¸»å…¥å£
    â””â”€â”€ tools/                 # å·¥å…·å­æ¨¡å—
        â”œâ”€â”€ manifest.json
        â””â”€â”€ custom_tools.sh
```

#### è‡ªåŠ¨Tabè¡¥å…¨ç”Ÿæˆç³»ç»Ÿ
```bash
# è¡¥å…¨ç³»ç»Ÿè‡ªåŠ¨åŒ–è®¾è®¡ (completion/completion_generator.sh)

# ä»manifestè‡ªåŠ¨ç”Ÿæˆè¡¥å…¨è„šæœ¬
gs_generate_completion() {
    local plugin_name="$1"
    local plugin_dir="${GS_PLUGIN_REGISTRY[$plugin_name]}"
    local manifest_file="$plugin_dir/manifest.json"
    
    # è§£æä¸»æ’ä»¶manifest
    local commands
    commands=$(jq -r '.commands | keys[]' "$manifest_file")
    
    # ç”Ÿæˆä¸»æ’ä»¶è¡¥å…¨
    generate_plugin_completion "$plugin_name" "$commands"
    
    # è§£æå¹¶ç”Ÿæˆå­æ¨¡å—è¡¥å…¨
    local submodules
    submodules=$(jq -r '.submodules // {} | keys[]' "$manifest_file" 2>/dev/null)
    
    for submodule in $submodules; do
        local submodule_manifest="$plugin_dir/$submodule/manifest.json"
        if [[ -f "$submodule_manifest" ]]; then
            local sub_commands
            sub_commands=$(jq -r '.commands | keys[]' "$submodule_manifest")
            generate_submodule_completion "$plugin_name" "$submodule" "$sub_commands"
        fi
    done
}

# ç”Ÿæˆæ’ä»¶å‘½ä»¤è¡¥å…¨
generate_plugin_completion() {
    local plugin_name="$1"
    local commands="$2"
    
    for command in $commands; do
        local completion_func="${command//-/_}_completion"
        
        # æ£€æŸ¥æ˜¯å¦æœ‰è‡ªå®šä¹‰è¡¥å…¨å‡½æ•°
        if declare -F "$completion_func" >/dev/null 2>&1; then
            register_custom_completion "$command" "$completion_func"
        else
            # è‡ªåŠ¨ç”ŸæˆåŸºç¡€è¡¥å…¨
            generate_auto_completion "$command" "$plugin_name"
        fi
    done
}

# è‡ªåŠ¨ç”ŸæˆåŸºç¡€è¡¥å…¨é€»è¾‘
generate_auto_completion() {
    local command="$1" 
    local plugin_name="$2"
    local manifest_file="${GS_PLUGIN_REGISTRY[$plugin_name]}/manifest.json"
    
    # ä»manifestæå–å‘½ä»¤å‚æ•°ä¿¡æ¯
    local command_info
    command_info=$(jq -r ".commands[\"$command\"]" "$manifest_file")
    
    # ç”Ÿæˆå‚æ•°è¡¥å…¨
    local completion_script="
_${command//-/_}_completion() {
    local cur=\${COMP_WORDS[COMP_CWORD]}
    local prev=\${COMP_WORDS[COMP_CWORD-1]}
    
    case \"\$prev\" in"
    
    # æ·»åŠ é€šç”¨å‚æ•°è¡¥å…¨
    completion_script+="
        --format)
            COMPREPLY=(\$(compgen -W 'json text table' -- \"\$cur\"))
            return 0
            ;;
        --config)
            COMPREPLY=(\$(compgen -f -- \"\$cur\"))
            return 0
            ;;"
    
    # ä»manifestæ·»åŠ ç‰¹å®šå‚æ•°è¡¥å…¨
    local params
    params=$(echo "$command_info" | jq -r '.parameters // {} | keys[]' 2>/dev/null)
    
    for param in $params; do
        local param_type
        param_type=$(echo "$command_info" | jq -r ".parameters[\"$param\"].type" 2>/dev/null)
        
        case "$param_type" in
            "file")
                completion_script+="
        --$param)
            COMPREPLY=(\$(compgen -f -- \"\$cur\"))
            return 0
            ;;"
                ;;
            "directory")
                completion_script+="
        --$param)
            COMPREPLY=(\$(compgen -d -- \"\$cur\"))
            return 0
            ;;"
                ;;
        esac
    done
    
    completion_script+="
    esac
    
    # é»˜è®¤é€‰é¡¹è¡¥å…¨
    local opts='--help --verbose --quiet --json --format'
    COMPREPLY=(\$(compgen -W \"\$opts\" -- \"\$cur\"))
}

complete -F _${command//-/_}_completion $command"
    
    # å†™å…¥è¡¥å…¨è„šæœ¬æ–‡ä»¶
    echo "$completion_script" > "$GS_COMPLETION_DIR/${command}.completion"
}

# æ’ä»¶åŠ è½½æ—¶è‡ªåŠ¨æ³¨å†Œè¡¥å…¨
gs_plugin_register_completion() {
    local plugin_name="$1"
    
    # ç”Ÿæˆè¡¥å…¨è„šæœ¬
    gs_generate_completion "$plugin_name"
    
    # åŠ è½½è¡¥å…¨è„šæœ¬
    local completion_files="$GS_COMPLETION_DIR/${plugin_name}_*.completion"
    for completion_file in $completion_files; do
        [[ -f "$completion_file" ]] && source "$completion_file"
    done
    
    gs_log "DEBUG" "å·²æ³¨å†Œæ’ä»¶è¡¥å…¨: $plugin_name"
}

# å­æ¨¡å—è¡¥å…¨æ”¯æŒ
generate_submodule_completion() {
    local plugin_name="$1"
    local submodule="$2" 
    local commands="$3"
    
    for command in $commands; do
        # å­æ¨¡å—å‘½ä»¤é€šå¸¸ä»¥çˆ¶æ’ä»¶åå¼€å¤´
        if [[ "$command" == gs-${plugin_name}-* ]]; then
            generate_auto_completion "$command" "$plugin_name"
        fi
    done
}

# åŠ¨æ€è¡¥å…¨æ•°æ®è·å–
get_dynamic_completion_data() {
    local command="$1"
    local current_word="$2"
    
    case "$command" in
        "gs-android-device-list"|"gs-android-adb-shell")
            # åŠ¨æ€è·å–Androidè®¾å¤‡åˆ—è¡¨
            adb devices 2>/dev/null | awk 'NR>1 && $2=="device" {print $1}'
            ;;
        "gs-git-branch-create"|"gs-git-branch-delete")
            # åŠ¨æ€è·å–Gitåˆ†æ”¯åˆ—è¡¨
            git branch 2>/dev/null | sed 's/^[* ] //'
            ;;
        "gs-plugins-enable"|"gs-plugins-disable")
            # åŠ¨æ€è·å–æ’ä»¶åˆ—è¡¨
            gs-plugins-list --format json 2>/dev/null | jq -r '.[].name'
            ;;
    esac
}
```

# æ’ä»¶ç”Ÿå‘½å‘¨æœŸé’©å­
gs_plugin_hook() {
    local hook_name="$1"
    local plugin_name="$2"
    shift 2
    local hook_args=("$@")
    
    local manifest_file="${GS_PLUGIN_MANIFESTS[$plugin_name]}"
    local hook_function
    hook_function=$(jq -r ".hooks.$hook_name // empty" "$manifest_file")
    
    if [[ -n "$hook_function" ]] && declare -F "$hook_function" &>/dev/null; then
        gs_log "DEBUG" "æ‰§è¡Œæ’ä»¶é’©å­: $plugin_name.$hook_function"
        "$hook_function" "${hook_args[@]}"
    fi
}

# æ’ä»¶å‘½ä»¤æ³¨å†Œ
gs_plugin_register_command() {
    local command_name="$1"
    local function_name="$2"
    local plugin_name="$3"
    
    GS_COMMAND_REGISTRY["$command_name"]="$plugin_name:$function_name"
    gs_log "DEBUG" "æ³¨å†Œæ’ä»¶å‘½ä»¤: $command_name -> $plugin_name:$function_name"
}

# æ’ä»¶é…ç½®è®¿é—®
gs_plugin_config_get() {
    local plugin_name="$1"
    local config_key="$2"
    local default_value="$3"
    
    gs_config_get "plugins.$plugin_name.$config_key" "$default_value"
}
```

## ğŸ¯ å‘½ä»¤æ¥å£è®¾è®¡

### 5.1 å‘½ä»¤è§„èŒƒ

#### å‘½åè§„èŒƒ
```bash
# å‘½ä»¤å‘½åæ¨¡å¼
gs-<category>-<action>[-<target>]

# ç¤ºä¾‹
gs-help                        # ç³»ç»Ÿå‘½ä»¤
gs-version                     # ç³»ç»Ÿå‘½ä»¤
gs-config-get                  # é…ç½®å‘½ä»¤
gs-plugins-list                # æ’ä»¶å‘½ä»¤
gs-android-device-list         # Androidæ’ä»¶å‘½ä»¤
gs-git-status-enhanced         # Gitæ’ä»¶å‘½ä»¤
```

#### å‚æ•°è§„èŒƒ
```bash
# é€šç”¨å‚æ•°
--help, -h                     # æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
--verbose, -v                  # è¯¦ç»†è¾“å‡ºæ¨¡å¼
--quiet, -q                    # é™é»˜æ¨¡å¼
--json                         # JSONæ ¼å¼è¾“å‡º
--format <fmt>                 # æŒ‡å®šè¾“å‡ºæ ¼å¼
--config <file>                # æŒ‡å®šé…ç½®æ–‡ä»¶
```

### 5.2 æ ¸å¿ƒå‘½ä»¤æ¥å£

#### å¸®åŠ©ç³»ç»Ÿ (gs-help)
```bash
# å¸®åŠ©å‘½ä»¤è®¾è®¡
gs-help [command]              # æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯

# ä½¿ç”¨ç¤ºä¾‹
gs-help                        # æ˜¾ç¤ºæ€»ä½“å¸®åŠ©
gs-help config                 # æ˜¾ç¤ºé…ç½®ç›¸å…³å‘½ä»¤å¸®åŠ©
gs-help gs-android-device-list # æ˜¾ç¤ºç‰¹å®šå‘½ä»¤å¸®åŠ©

# å¸®åŠ©ä¿¡æ¯ç»“æ„
help_structure() {
    cat << 'EOF'
Global Scripts V3 - ç°ä»£åŒ–Shellå¼€å‘å·¥å…·æ¡†æ¶

ç”¨æ³•: gs-<command> [options] [arguments]

æ ¸å¿ƒå‘½ä»¤:
  help                æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
  version             æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯
  status              æ˜¾ç¤ºç³»ç»ŸçŠ¶æ€

é…ç½®ç®¡ç†:
  config-get          è·å–é…ç½®å€¼
  config-set          è®¾ç½®é…ç½®å€¼
  config-list         åˆ—å‡ºæ‰€æœ‰é…ç½®
  config-validate     éªŒè¯é…ç½®æ–‡ä»¶

æ’ä»¶ç®¡ç†:
  plugins-list        åˆ—å‡ºæ’ä»¶
  plugins-enable      å¯ç”¨æ’ä»¶
  plugins-disable     ç¦ç”¨æ’ä»¶
  plugins-info        æŸ¥çœ‹æ’ä»¶ä¿¡æ¯

å·¥å…·å‘½ä»¤:
  tools-health        ç³»ç»Ÿå¥åº·æ£€æŸ¥
  tools-performance   æ€§èƒ½åˆ†æ
  tools-cache         ç¼“å­˜ç®¡ç†

ä½¿ç”¨ 'gs-help <command>' æŸ¥çœ‹å…·ä½“å‘½ä»¤çš„è¯¦ç»†å¸®åŠ©
EOF
}
```

#### ç‰ˆæœ¬ä¿¡æ¯ (gs-version)
```bash
# ç‰ˆæœ¬å‘½ä»¤è®¾è®¡
gs-version [--json] [--detailed]

# å®ç°ç¤ºä¾‹
gs_version() {
    local format="text"
    local detailed="false"
    
    while [[ $# -gt 0 ]]; do
        case $1 in
            --json)
                format="json"
                shift
                ;;
            --detailed)
                detailed="true"
                shift
                ;;
            *)
                gs_error "æœªçŸ¥å‚æ•°: $1"
                ;;
        esac
    done
    
    if [[ "$format" == "json" ]]; then
        output_version_json "$detailed"
    else
        output_version_text "$detailed"
    fi
}

# JSONæ ¼å¼è¾“å‡º
output_version_json() {
    local detailed="$1"
    
    local version_info='{
        "version": "'$(cat "$GS_ROOT/VERSION")'",
        "build_date": "'$(date -r "$GS_ROOT/VERSION" '+%Y-%m-%d')'",
        "shell": "'$0'",
        "platform": "'$(uname -s)'",
        "architecture": "'$(uname -m)'"'
    
    if [[ "$detailed" == "true" ]]; then
        version_info+=',
        "dependencies": {
            "python": "'$(python3 --version 2>&1 | cut -d' ' -f2)'",
            "jq": "'$(jq --version 2>&1)'",
            "git": "'$(git --version 2>&1 | cut -d' ' -f3)'"
        },
        "plugins": ['
        
        # æ·»åŠ æ’ä»¶ä¿¡æ¯
        local first=true
        for plugin in "${!GS_PLUGIN_REGISTRY[@]}"; do
            [[ "$first" == "true" ]] && first=false || version_info+=','
            local plugin_version
            plugin_version=$(jq -r '.version // "unknown"' "${GS_PLUGIN_MANIFESTS[$plugin]}")
            version_info+='"'$plugin'": "'$plugin_version'"'
        done
        
        version_info+=']'
    fi
    
    version_info+='}'
    echo "$version_info" | jq .
}
```

#### ç³»ç»ŸçŠ¶æ€ (gs-status)
```bash
# çŠ¶æ€å‘½ä»¤è®¾è®¡
gs-status [--summary] [--json] [--detailed]

# çŠ¶æ€æ£€æŸ¥å®ç°
gs_status() {
    local format="text"
    local mode="full"
    
    while [[ $# -gt 0 ]]; do
        case $1 in
            --summary)
                mode="summary"
                shift
                ;;
            --json)
                format="json"
                shift
                ;;
            --detailed)
                mode="detailed"
                shift
                ;;
            *)
                gs_error "æœªçŸ¥å‚æ•°: $1"
                ;;
        esac
    done
    
    case "$mode" in
        "summary")
            show_status_summary "$format"
            ;;
        "detailed")
            show_status_detailed "$format"
            ;;
        *)
            show_status_full "$format"
            ;;
    esac
}

# å®Œæ•´çŠ¶æ€æ˜¾ç¤º
show_status_full() {
    local format="$1"
    
    if [[ "$format" == "json" ]]; then
        show_status_json
    else
        show_status_text
    fi
}

show_status_text() {
    cat << EOF
Global Scripts V3 ç³»ç»ŸçŠ¶æ€
==========================

ç³»ç»Ÿä¿¡æ¯:
  ç‰ˆæœ¬: $(cat "$GS_ROOT/VERSION")
  å¹³å°: $(uname -s) $(uname -m)
  Shell: $0

è¿è¡ŒçŠ¶æ€:
  å¯åŠ¨æ—¶é—´: ${GS_STARTUP_TIME:-æœªçŸ¥}ms
  å†…å­˜ä½¿ç”¨: $(ps -o rss= -p $$ | awk '{print $1/1024 "MB"}')
  è¿›ç¨‹ID: $$

é…ç½®çŠ¶æ€:
  é…ç½®æ–‡ä»¶: $(test -f "$HOME/.gs/config.json" && echo "âœ“ å­˜åœ¨" || echo "âœ— ä¸å­˜åœ¨")
  é…ç½®æœ‰æ•ˆ: $(gs_config_validate >/dev/null 2>&1 && echo "âœ“ æœ‰æ•ˆ" || echo "âœ— æ— æ•ˆ")

æ’ä»¶çŠ¶æ€:
$(for plugin in "${!GS_PLUGIN_REGISTRY[@]}"; do
    local status="${GS_PLUGIN_STATE[$plugin]:-unknown}"
    printf "  %-20s %s\n" "$plugin:" "$status"
done)

ç¼“å­˜çŠ¶æ€:
  L1ç¼“å­˜: ${#GS_CACHE_L1[@]} æ¡ç›®
  L2ç¼“å­˜: $(find "$HOME/.gs/cache" -name "*.cache" 2>/dev/null | wc -l) æ–‡ä»¶

ä¾èµ–æ£€æŸ¥:
$(check_dependencies_status)
EOF
}
```

### 5.3 é…ç½®ç®¡ç†æ¥å£

#### é…ç½®æ“ä½œå‘½ä»¤
```bash
# é…ç½®ç®¡ç†å‘½ä»¤é›†
gs-config-get <key> [default]           # è·å–é…ç½®å€¼
gs-config-set <key> <value>             # è®¾ç½®é…ç½®å€¼
gs-config-list [pattern]                # åˆ—å‡ºé…ç½®é¡¹
gs-config-init                          # åˆå§‹åŒ–é…ç½®
gs-config-validate [file]               # éªŒè¯é…ç½®
gs-config-reset [key]                   # é‡ç½®é…ç½®
gs-config-backup [file]                 # å¤‡ä»½é…ç½®
gs-config-restore <file>                # æ¢å¤é…ç½®
gs-config-merge <file>                  # åˆå¹¶é…ç½®
gs-config-diff                          # é…ç½®å·®å¼‚
gs-config-schema [operation]            # Schemaæ“ä½œ

# é…ç½®è·å–å®ç°
gs_config_get_cmd() {
    local key="$1"
    local default_value="$2"
    
    if [[ -z "$key" ]]; then
        # æ˜¾ç¤ºæ‰€æœ‰é…ç½®
        jq . "$HOME/.gs/config.json" 2>/dev/null || echo "{}"
        return 0
    fi
    
    local value
    value=$(gs_config_get "$key" "$default_value")
    echo "$value"
}

# é…ç½®è®¾ç½®å®ç°
gs_config_set_cmd() {
    local key="$1"
    local value="$2"
    
    [[ -n "$key" && -n "$value" ]] || {
        gs_error "ç”¨æ³•: gs-config-set <key> <value>"
    }
    
    # éªŒè¯keyæ ¼å¼
    if [[ ! "$key" =~ ^[a-zA-Z_][a-zA-Z0-9_]*(\.[a-zA-Z_][a-zA-Z0-9_]*)*$ ]]; then
        gs_error "æ— æ•ˆçš„é…ç½®é”®: $key"
    fi
    
    # è®¾ç½®é…ç½®
    gs_config_set "$key" "$value"
    
    echo "é…ç½®å·²æ›´æ–°: $key = $value"
}

# é…ç½®éªŒè¯å®ç°
gs_config_validate_cmd() {
    local config_file="${1:-$HOME/.gs/config.json}"
    
    if [[ ! -f "$config_file" ]]; then
        gs_error "é…ç½®æ–‡ä»¶ä¸å­˜åœ¨: $config_file"
    fi
    
    # JSONæ ¼å¼æ£€æŸ¥
    if ! jq . "$config_file" >/dev/null 2>&1; then
        gs_error "é…ç½®æ–‡ä»¶JSONæ ¼å¼é”™è¯¯"
    fi
    
    # SchemaéªŒè¯
    if command -v python3 &>/dev/null; then
        python3 "$GS_ROOT/tools/config_validator.py" "$config_file"
    else
        echo "è­¦å‘Š: æ— Pythonç¯å¢ƒï¼Œè·³è¿‡SchemaéªŒè¯"
    fi
    
    echo "é…ç½®æ–‡ä»¶éªŒè¯é€šè¿‡: $config_file"
}
```

### 5.4 æ’ä»¶ç®¡ç†æ¥å£

#### æ’ä»¶æ“ä½œå‘½ä»¤
```bash
# æ’ä»¶ç®¡ç†å‘½ä»¤é›†
gs-plugins-list [--enabled|--available] [--format json]  # åˆ—å‡ºæ’ä»¶
gs-plugins-info <plugin>                                 # æ’ä»¶è¯¦æƒ…ï¼ˆæ¯”å¦‚æ’ä»¶ä½¿ç”¨å‘½ä»¤ï¼‰
gs-plugins-enable <plugin> [...]                         # å¯ç”¨æ’ä»¶
gs-plugins-disable <plugin> [...]                        # ç¦ç”¨æ’ä»¶
gs-plugins-reload <plugin|--all>                         # é‡è½½æ’ä»¶
gs-plugins-validate <plugin>                             # éªŒè¯æ’ä»¶
gs-plugins-search <pattern>                              # æœç´¢æ’ä»¶
gs-plugins-create <name>                                 # åˆ›å»ºæ’ä»¶
gs-plugins-install <path>                                # å®‰è£…æ’ä»¶
gs-plugins-uninstall <plugin>                            # å¸è½½æ’ä»¶

# æ’ä»¶åˆ—è¡¨å®ç°
gs_plugins_list_cmd() {
    local filter="all"
    local format="text"
    
    while [[ $# -gt 0 ]]; do
        case $1 in
            --enabled)
                filter="enabled"
                shift
                ;;
            --available)
                filter="available"
                shift
                ;;
            --format)
                format="$2"
                shift 2
                ;;
            *)
                gs_error "æœªçŸ¥å‚æ•°: $1"
                ;;
        esac
    done
    
    case "$format" in
        "json")
            output_plugins_json "$filter"
            ;;
        *)
            output_plugins_text "$filter"
            ;;
    esac
}

# æ–‡æœ¬æ ¼å¼è¾“å‡ºæ’ä»¶åˆ—è¡¨
output_plugins_text() {
    local filter="$1"
    
    printf "%-20s %-10s %-40s\n" "æ’ä»¶åç§°" "çŠ¶æ€" "æè¿°"
    printf "%-20s %-10s %-40s\n" "--------" "------" "----"
    
    for plugin in "${!GS_PLUGIN_REGISTRY[@]}"; do
        local status="${GS_PLUGIN_STATE[$plugin]:-unknown}"
        local manifest_file="${GS_PLUGIN_MANIFESTS[$plugin]}"
        local description
        description=$(jq -r '.description // "æ— æè¿°"' "$manifest_file")
        
        # åº”ç”¨è¿‡æ»¤å™¨
        case "$filter" in
            "enabled")
                [[ "$status" == "loaded" ]] || continue
                ;;
            "available")
                [[ "$status" != "loaded" ]] || continue
                ;;
        esac
        
        printf "%-20s %-10s %-40s\n" "$plugin" "$status" "$description"
    done
}

# æ’ä»¶å¯ç”¨å®ç°
gs_plugins_enable_cmd() {
    [[ $# -gt 0 ]] || gs_error "ç”¨æ³•: gs-plugins-enable <plugin> [...]"
    
    local enabled_plugins=()
    local failed_plugins=()
    
    for plugin in "$@"; do
        if gs_plugin_enable "$plugin"; then
            enabled_plugins+=("$plugin")
        else
            failed_plugins+=("$plugin")
        fi
    done
    
    # æŠ¥å‘Šç»“æœ
    if [[ ${#enabled_plugins[@]} -gt 0 ]]; then
        echo "å·²å¯ç”¨æ’ä»¶: ${enabled_plugins[*]}"
    fi
    
    if [[ ${#failed_plugins[@]} -gt 0 ]]; then
        echo "å¯ç”¨å¤±è´¥: ${failed_plugins[*]}" >&2
        return 1
    fi
}
```

## ğŸš€ æ€§èƒ½ä¼˜åŒ–è®¾è®¡

### 6.1 å¯åŠ¨æ€§èƒ½ä¼˜åŒ–

#### æ‡’åŠ è½½ç­–ç•¥
```bash
# æ‡’åŠ è½½å®ç°
lazy_loading_strategy() {
    # é˜¶æ®µ1: æ ¸å¿ƒç³»ç»Ÿåˆå§‹åŒ– (< 50ms)
    stage1_core_init() {
        load_essential_modules
        setup_basic_environment
        register_core_commands
    }
    
    # é˜¶æ®µ2: æŒ‰éœ€æ’ä»¶åŠ è½½ (< 100ms per plugin)
    stage2_plugin_loading() {
        # åªæœ‰åœ¨å®é™…è°ƒç”¨æ—¶æ‰åŠ è½½æ’ä»¶
        lazy_load_plugin_on_demand
    }
    
    # é˜¶æ®µ3: ç¼“å­˜é¢„çƒ­ (åå°å¼‚æ­¥)
    stage3_cache_warming() {
        # å¼‚æ­¥é¢„çƒ­å¸¸ç”¨æ•°æ®
        warm_cache_async &
    }
}

# æŒ‰éœ€åŠ è½½å®ç°
lazy_load_command() {
    local command="$1"
    shift
    local args=("$@")
    
    # æŸ¥æ‰¾å‘½ä»¤å¯¹åº”çš„æ’ä»¶
    local plugin_info="${GS_COMMAND_REGISTRY[$command]}"
    if [[ -z "$plugin_info" ]]; then
        gs_error "æœªçŸ¥å‘½ä»¤: $command"
    fi
    
    local plugin_name="${plugin_info%%:*}"
    local function_name="${plugin_info#*:}"
    
    # æ£€æŸ¥æ’ä»¶æ˜¯å¦å·²åŠ è½½
    if [[ "${GS_PLUGIN_STATE[$plugin_name]}" != "loaded" ]]; then
        gs_log "DEBUG" "æŒ‰éœ€åŠ è½½æ’ä»¶: $plugin_name"
        gs_plugin_load "$plugin_name"
    fi
    
    # æ‰§è¡Œå‘½ä»¤
    "$function_name" "${args[@]}"
}
```

#### å¹¶è¡Œåˆå§‹åŒ–
```bash
# å¹¶è¡Œåˆå§‹åŒ–è®¾è®¡
parallel_initialization() {
    # å¯åŠ¨æ€§èƒ½ç›‘æ§
    gs_perf_start_timer "bootstrap"
    
    # å¹¶è¡Œæ‰§è¡Œç‹¬ç«‹çš„åˆå§‹åŒ–ä»»åŠ¡
    {
        initialize_cache_system
        echo "cache_init_done" > "$GS_TEMP_DIR/init.cache"
    } &
    
    {
        initialize_configuration
        echo "config_init_done" > "$GS_TEMP_DIR/init.config"
    } &
    
    {
        discover_plugins
        echo "plugin_discovery_done" > "$GS_TEMP_DIR/init.plugins"
    } &
    
    # ç­‰å¾…å…³é”®ä»»åŠ¡å®Œæˆ
    wait_for_critical_init
    
    # ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ
    wait
    
    gs_perf_end_timer "bootstrap"
}

# ç­‰å¾…å…³é”®åˆå§‹åŒ–å®Œæˆ
wait_for_critical_init() {
    local timeout=5  # 5ç§’è¶…æ—¶
    local elapsed=0
    
    while [[ $elapsed -lt $timeout ]]; do
        if [[ -f "$GS_TEMP_DIR/init.config" ]]; then
            break
        fi
        sleep 0.1
        ((elapsed++))
    done
    
    if [[ ! -f "$GS_TEMP_DIR/init.config" ]]; then
        gs_error "é…ç½®åˆå§‹åŒ–è¶…æ—¶"
    fi
}
```

### 6.2 åŒçº§ç¼“å­˜ç³»ç»Ÿ

#### L1å†…å­˜ç¼“å­˜
```bash
# L1ç¼“å­˜è®¾è®¡
declare -gA GS_CACHE_L1=()             # å†…å­˜ç¼“å­˜
declare -g GS_CACHE_L1_MAX_SIZE=1000   # æœ€å¤§æ¡ç›®æ•°
declare -g GS_CACHE_L1_TTL=3600        # é»˜è®¤TTL(ç§’)

# L1ç¼“å­˜æ“ä½œ
gs_cache_l1_get() {
    local key="$1"
    local cached_data="${GS_CACHE_L1[$key]}"
    
    [[ -n "$cached_data" ]] || return 1
    
    local timestamp="${cached_data%%:*}"
    local value="${cached_data#*:}"
    local current_time=$(date +%s)
    
    if [[ $((current_time - timestamp)) -lt $GS_CACHE_L1_TTL ]]; then
        echo "$value"
        return 0
    else
        unset "GS_CACHE_L1[$key]"  # è¿‡æœŸæ¸…ç†
        return 1
    fi
}

gs_cache_l1_set() {
    local key="$1"
    local value="$2"
    local timestamp=$(date +%s)
    
    # æ£€æŸ¥ç¼“å­˜å¤§å°é™åˆ¶
    if [[ ${#GS_CACHE_L1[@]} -ge $GS_CACHE_L1_MAX_SIZE ]]; then
        gs_cache_l1_evict
    fi
    
    GS_CACHE_L1[$key]="$timestamp:$value"
}

# L1ç¼“å­˜æ·˜æ±°ç­–ç•¥ (ç®€å•LRU)
gs_cache_l1_evict() {
    local evict_count=$((${#GS_CACHE_L1[@]} / 4))  # æ·˜æ±°25%
    local -a keys_to_evict=()
    local count=0
    
    for key in "${!GS_CACHE_L1[@]}"; do
        [[ $count -lt $evict_count ]] || break
        keys_to_evict+=("$key")
        ((count++))
    done
    
    for key in "${keys_to_evict[@]}"; do
        unset "GS_CACHE_L1[$key]"
    done
    
    gs_log "DEBUG" "L1ç¼“å­˜æ·˜æ±°: ç§»é™¤ $count æ¡ç›®"
}
```

#### L2ç£ç›˜ç¼“å­˜
```bash
# L2ç¼“å­˜è®¾è®¡
declare -g GS_CACHE_L2_DIR="$HOME/.gs/cache"
declare -g GS_CACHE_L2_TTL=86400        # 24å°æ—¶TTL

# L2ç¼“å­˜æ“ä½œ
gs_cache_l2_get() {
    local key="$1"
    local cache_file="$GS_CACHE_L2_DIR/$(echo -n "$key" | sha256sum | cut -d' ' -f1).cache"
    
    [[ -f "$cache_file" ]] || return 1
    
    # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦è¿‡æœŸ
    local file_time
    file_time=$(stat -f%m "$cache_file" 2>/dev/null || stat -c%Y "$cache_file" 2>/dev/null)
    local current_time=$(date +%s)
    
    if [[ $((current_time - file_time)) -lt $GS_CACHE_L2_TTL ]]; then
        cat "$cache_file"
        return 0
    else
        rm -f "$cache_file"  # è¿‡æœŸåˆ é™¤
        return 1
    fi
}

gs_cache_l2_set() {
    local key="$1"
    local value="$2"
    local cache_file="$GS_CACHE_L2_DIR/$(echo -n "$key" | sha256sum | cut -d' ' -f1).cache"
    
    mkdir -p "$GS_CACHE_L2_DIR"
    echo "$value" > "$cache_file"
}

# ç»Ÿä¸€ç¼“å­˜æ¥å£
gs_cache_get() {
    local key="$1"
    local default_value="$2"
    
    # å…ˆæ£€æŸ¥L1ç¼“å­˜
    local value
    if value=$(gs_cache_l1_get "$key"); then
        echo "$value"
        return 0
    fi
    
    # å†æ£€æŸ¥L2ç¼“å­˜
    if value=$(gs_cache_l2_get "$key"); then
        # å›å¡«L1ç¼“å­˜
        gs_cache_l1_set "$key" "$value"
        echo "$value"
        return 0
    fi
    
    # ç¼“å­˜æœªå‘½ä¸­
    echo "$default_value"
    return 1
}

gs_cache_set() {
    local key="$1"
    local value="$2"
    
    # åŒæ—¶æ›´æ–°L1å’ŒL2ç¼“å­˜
    gs_cache_l1_set "$key" "$value"
    
    # å¼‚æ­¥æ›´æ–°L2ç¼“å­˜
    (gs_cache_l2_set "$key" "$value") &
}
```

è¿™ä¸ªæ¶æ„è®¾è®¡ä¿æŒäº†åŸå¤±è´¥é‡æ„çš„ä¼˜ç§€è®¾è®¡ç†å¿µï¼Œä½†å»é™¤äº†å¤æ‚æ€§ï¼Œæ›´åŠ å®ç”¨å’Œå¯ç»´æŠ¤ã€‚é‡ç‚¹ä½“ç°åœ¨ç®€æ´çš„æŠ€æœ¯æ ˆã€æ¸…æ™°çš„åˆ†å±‚æ¶æ„ã€çµæ´»çš„æ’ä»¶ç³»ç»Ÿï¼Œä»¥åŠé«˜æ•ˆçš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ã€‚